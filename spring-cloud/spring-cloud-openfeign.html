<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Spring Cloud OpenFeign - Spring中文文档</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Spring,SpringBoot,SpringCloud最新中文文档">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../index.html">Index</a></li><li class="chapter-item "><a href="../spring-boot/index.html">Spring Boot</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-boot/getting-started.html">开始使用</a></li><li class="chapter-item "><a href="../spring-boot/upgrading.html">升级Spring Boot应用</a></li><li class="chapter-item "><a href="../spring-boot/using.html">使用Spring Boot</a></li><li class="chapter-item "><a href="../spring-boot/features.html">Sring Boot特性</a></li><li class="chapter-item "><a href="../spring-boot/actuator.html">Spring Boot Actuator</a></li><li class="chapter-item "><a href="../spring-boot/cli.html">Spring Boot CLI</a></li><li class="chapter-item "><a href="../spring-boot/deployment.html">部署Spring Boot应用</a></li><li class="chapter-item "><a href="../spring-boot/build-tool-plugins.html">构建工具插件</a></li><li class="chapter-item "><a href="../spring-boot/howto.html">“How-to”指南</a></li><li class="chapter-item "><a href="../spring-boot/application-properties.html">Application Properties</a></li><li class="chapter-item "><a href="../spring-boot/configuration-metadata.html">Configuration Metadata</a></li><li class="chapter-item "><a href="../spring-boot/auto-configuration-classes.html">Auto-configuration classes</a></li><li class="chapter-item "><a href="../spring-boot/test-auto-configuration.html">Test auto-configuration annotations</a></li><li class="chapter-item "><a href="../spring-boot/executable-jar.html">可执行Jar</a></li><li class="chapter-item "><a href="../spring-boot/dependency-versions.html">依赖版本号</a></li></ol></li><li class="chapter-item "><a href="../spring-framework/index.html">Spring Framework</a></li><li class="chapter-item "><a href="../spring-data/index.html">Spring Data</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-data/spring-data-jdbc.html">Spring Data JDBC</a></li><li class="chapter-item "><a href="../spring-data/spring-data-jpa.html">Spring Data JPA</a></li><li class="chapter-item "><a href="../spring-data/spring-data-ldap.html">Spring Data LDAP</a></li><li class="chapter-item "><a href="../spring-data/spring-data-mongodb.html">Spring Data MongoDB</a></li><li class="chapter-item "><a href="../spring-data/spring-data-redis.html">Spring Data Redis</a></li><li class="chapter-item "><a href="../spring-data/spring-data-r2dbc.html">Spring Data R2DBC</a></li><li class="chapter-item "><a href="../spring-data/spring-data-rest.html">Spring Data REST</a></li><li class="chapter-item "><a href="../spring-data//spring-data-cassandra.html">Spring Data for Apache Cassandra</a></li><li class="chapter-item "><a href="../spring-data/spring-data-geode.html">Spring Data for Apache Geode</a></li><li class="chapter-item "><a href="../spring-data/spring-data-solr.html">Spring Data for Apache Solr</a></li><li class="chapter-item "><a href="../spring-data/spring-data-gemfire.html">Spring Data for Pivotal GemFire</a></li><li class="chapter-item "><a href="../spring-data/spring-data-couchbase.html">Spring Data Couchbase</a></li><li class="chapter-item "><a href="../spring-data/spring-data-elasticsearch.html">Spring Data Elasticsearch</a></li><li class="chapter-item "><a href="../spring-data/spring-data-envers.html">Spring Data Envers</a></li><li class="chapter-item "><a href="../spring-data/spring-data-neo4j.html">Spring Data Neo4j</a></li><li class="chapter-item "><a href="../spring-data/spring-data-jdbc-ext.html">Spring Data JDBC Extensions</a></li><li class="chapter-item "><a href="../spring-data/spring-hadoop.html">Spring for Apache Hadoop</a></li></ol></li><li class="chapter-item expanded "><a href="../spring-cloud/index.html">Spring Cloud</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-cloud/spring-cloud-azure.html">Spring Cloud Azure</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-alibaba.html">Spring Cloud Alibaba</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-for-amazon-web-services.html">Spring Cloud for Amazon Web Services</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-bus.html">Spring Cloud Bus</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-circuit-breaker.html">Spring Cloud Circuit Breaker</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-cli.html">Spring Cloud CLI</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-for-cloud-foundry.html">Spring Cloud for Cloud Foundry</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-cloud-foundry-service-nroker.html">Spring Cloud - Cloud Foundry Service Broker</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-cluster.html">Spring Cloud Cluster</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-commons.html">Spring Cloud Commons</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-config.html">Spring Cloud Config</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-cconnectors.html">Spring Cloud Connectors</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-consul.html">Spring Cloud Consul</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-contract.html">Spring Cloud Contract</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-function.html">Spring Cloud Function</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-gateway.html">Spring Cloud Gateway</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-gcp.html">Spring Cloud GCP</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-kubernetes.html">Spring Cloud Kubernetes</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-netflix].html">Spring Cloud Netflix</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-open-service-broker.html">Spring Cloud Open Service Broker</a></li><li class="chapter-item expanded "><a href="../spring-cloud/spring-cloud-openfeign.html" class="active">Spring Cloud OpenFeign</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-pipelines.html">Spring Cloud Pipelines</a></li><li class="chapter-item "><a href="../spring-cloud-schema-registry.html">Spring Cloud Schema Registry</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-security.html">Spring Cloud Security</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-skipper.html">Spring Cloud Skipper</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth.html">Spring Cloud Sleuth</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/getting-started.html">入门使用</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/using.html">使用 Spring Cloud Sleuth</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/features.html">Spring Cloud Sleuth 特性</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/howto.html">“How-to” 指南</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/sleuth-integration.html">Spring Cloud Sleuth 整合</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/appendix.html">附录</a></li></ol></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream.html">Spring Cloud Stream</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-reference.html">Overview</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-binder-rabbit.html">Rabbit MQ Binder</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-binder-kafka.html">Apache Kafka Binder</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-binder-kafka.html">Apache Kafka Streams Binder</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-samples.html">Spring Cloud Stream Samples</a></li></ol></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream-app-starters.html">Spring Cloud Stream App Starters</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream-applications.html">Spring Cloud Stream Applications</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-task.html">Spring Cloud Task</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-task-app-starters.html">Spring Cloud Task App Starters</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-vault.html">Spring Cloud Vault</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-zookeeper.html">Spring Cloud Zookeeper</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-app-broker.html">Spring Cloud App Broker</a></li></ol></li><li class="chapter-item "><a href="../spring-cloud-dataflow/index.html">Spring Cloud Data Flow</a></li><li class="chapter-item "><a href="../spring-security/index.html">Spring Security</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-security/spring-security-kerberos.html">Spring Security Kerberos</a></li><li class="chapter-item "><a href="../spring-security/spring-security-oauth.html">Spring Security OAuth</a></li><li class="chapter-item "><a href="../spring-security/spring-security-saml.html">Spring Security SAML</a></li></ol></li><li class="chapter-item "><a href="../spring-graphql/index.html">Spring GraphQL</a></li><li class="chapter-item "><a href="../spring-session/index.html">Spring Session</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-session/spring-session-core.html">Spring Session Core</a></li><li class="chapter-item "><a href="../spring-session/spring-session-data-redis.html">Spring Session Data Redis</a></li><li class="chapter-item "><a href="../spring-session/spring-session-jdbc.html">Spring Session JDBC</a></li><li class="chapter-item "><a href="../spring-session/spring-session-hazelcast.html">Spring Session Hazelcast</a></li><li class="chapter-item "><a href="../spring-session/spring-session-data-mongodb.html">Spring Session MongoDB</a></li><li class="chapter-item "><a href="../spring-session/spring-session-data-geode.html">Spring Session for Apache Geode</a></li></ol></li><li class="chapter-item "><a href="../spring-integration/index.html">Spring Integration</a></li><li class="chapter-item "><a href="../spring-hateoas/index.html">Spring HATEOAS</a></li><li class="chapter-item "><a href="../spring-restdocs/index.html">Spring REST Docs</a></li><li class="chapter-item "><a href="../spring-batch/index.html">Spring Batch</a></li><li class="chapter-item "><a href="../spring-amqp/index.html">Spring AMQP</a></li><li class="chapter-item "><a href="../spring-credhub/index.html">Spring CredHub</a></li><li class="chapter-item "><a href="../spring-flo/index.html">Spring Flo</a></li><li class="chapter-item "><a href="../spring-kafka/index.html">Spring for Apache Kafka</a></li><li class="chapter-item "><a href="../spring-ldap/index.html">Spring LDAP</a></li><li class="chapter-item "><a href="../spring-roo/index.html">Spring Roo</a></li><li class="chapter-item "><a href="../spring-shell/index.html">Spring Shell</a></li><li class="chapter-item "><a href="../spring-statemachine/index.html">Spring Statemachine</a></li><li class="chapter-item "><a href="../spring-vault/index.html">Spring Vault</a></li><li class="chapter-item "><a href="../spring-webflow/index.html">Spring Web Flow</a></li><li class="chapter-item "><a href="../spring-ws/index.html">Spring Web Services</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Spring中文文档</h1>

                    <div class="right-buttons">
                                                                                                <a href="https://github.com/KevinBlandy/springcloud-document/edit/master/src/spring-cloud/spring-cloud-openfeign.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="spring-cloud-openfeign"><a class="header" href="#spring-cloud-openfeign">Spring Cloud OpenFeign</a></h1>
<ul>
<li>当前版本：3.0.3</li>
<li>修改时间：2021年7月24日</li>
<li>官方文档：<a href="https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/">https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/</a></li>
<li>源码仓库：<a href="https://github.com/spring-cloud/spring-cloud-openfeign">https://github.com/spring-cloud/spring-cloud-openfeign</a></li>
</ul>
<p>该项目通过自动配置和与Spring环境及其他Spring编程模型习语的绑定，为Spring Boot应用提供OpenFeign集成。</p>
<h2 id="1--声明式rest客户feign"><a class="header" href="#1--声明式rest客户feign">1.  声明式REST客户：Feign</a></h2>
<p><a href="https://github.com/OpenFeign/feign">Feign</a>是一个声明式的网络服务客户端。它使编写Web服务客户端更容易。要使用Feign，需要创建一个接口并对其进行注释。它有可插拔的注解支持，包括Feign注解和JAX-RS注解。Feign还支持可插入的编码器和解码器。Spring Cloud增加了对Spring MVC注释的支持，并支持使用Spring Web中默认使用的<code>HttpMessageConverters</code>。Spring Cloud集成了Eureka、Spring Cloud CircuitBreaker以及Spring Cloud LoadBalancer，以便在使用Feign时提供一个负载均衡的http客户端。</p>
<h3 id="11-如何引入-feign"><a class="header" href="#11-如何引入-feign">1.1. 如何引入 Feign</a></h3>
<p>要在你的项目中包含Feign，请使用group为<code>org.springframework.cloud</code>和artifact id为<code>spring-cloud-starter-openfeign</code>的<code>starter</code>。请参阅<a href="https://projects.spring.io/spring-cloud/">Spring Cloud项目页面</a>，了解关于用当前Spring Cloud发布列车设置构建系统的详细信息。</p>
<p>Example spring boot app</p>
<pre><code class="language-java">@SpringBootApplication
@EnableFeignClients
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

}
</code></pre>
<p>StoreClient.java</p>
<pre><code class="language-java">@FeignClient(&quot;stores&quot;)
public interface StoreClient {
    @RequestMapping(method = RequestMethod.GET, value = &quot;/stores&quot;)
    List&lt;Store&gt; getStores();

    @RequestMapping(method = RequestMethod.GET, value = &quot;/stores&quot;)
    Page&lt;Store&gt; getStores(Pageable pageable);

    @RequestMapping(method = RequestMethod.POST, value = &quot;/stores/{storeId}&quot;, consumes = &quot;application/json&quot;)
    Store update(@PathVariable(&quot;storeId&quot;) Long storeId, Store store);
}
</code></pre>
<p>在<code>@FeignClient</code>注解中，字符串值（上面的 &quot;stores&quot;）是一个任意的客户端名称，它被用来创建一个<a href="https://github.com/spring-cloud/spring-cloud-commons/blob/main/spring-cloud-loadbalancer/src/main/java/org/springframework/cloud/loadbalancer/blocking/client/BlockingLoadBalancerClient.java">Spring Cloud LoadBalancer客户端</a>。你也可以使用<code>url</code>属性指定一个URL（绝对值或只是一个主机名）。应用程序上下文中的Bean名称是接口的完全限定名称。要指定你自己的别名值，你可以使用<code>@FeignClient</code>注解的<code>qualifiers</code>值。</p>
<p>上面的负载平衡器客户端将想发现 &quot;stores &quot;服务的物理地址。如果你的应用程序是一个Eureka客户端，那么它将在Eureka服务注册表中解析该服务。如果你不想使用Eureka，你可以使用<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/current/reference/html/#simplediscoveryclient"><code>SimpleDiscoveryClient</code></a>在你的外部配置中配置一个服务器列表。</p>
<p>Spring Cloud OpenFeign支持Spring Cloud LoadBalancer的阻塞模式的所有可用功能。你可以在<a href="https://docs.spring.io/spring-cloud-commons/docs/current/reference/html/#spring-cloud-loadbalancer">项目文档</a>中阅读更多关于它们的信息。</p>
<h3 id="12-覆盖feign默认值"><a class="header" href="#12-覆盖feign默认值">1.2. 覆盖Feign默认值</a></h3>
<p>Spring Cloud的Feign支持中的一个核心概念是命名的客户端。每个feign客户端都是一个组件集合的一部分，这些组件一起工作，根据需要联系远程服务器，集合有一个名字，你作为应用开发者使用<code>@FeignClient</code>注解给它。Spring Cloud使用<code>FeignClientsConfiguration</code>为每个命名的客户端按需创建一个新的组合作为<code>ApplicationContext</code>。这包括（除其他外）一个<code>feign.Decoder</code>，一个<code>feign.Encoder</code>，和一个<code>feign.Contract</code>。通过使用<code>@FeignClient</code>注解的<code>contextId</code>属性，可以重写该集合的名称。</p>
<p>Spring Cloud允许你通过使用<code>@FeignClient</code>声明额外的配置（在<code>FeignClientsConfiguration</code>之上）来完全控制feign客户端。</p>
<p>Example</p>
<pre><code class="language-java">@FeignClient(name = &quot;stores&quot;, configuration = FooConfiguration.class)
public interface StoreClient {
    //..
}
</code></pre>
<p>在这种情况下，客户端由 <code>FeignClientsConfiguration</code> 中的组件和 <code>FooConfiguration</code>中的任何组件组成（后者将覆盖前者）。</p>
<blockquote>
<p><code>FooConfiguration</code>不需要用<code>@Configuration</code>来注释。然而，如果是这样的话，请注意将它从任何<code>@ComponentScan</code>中排除，否则将包括这个配置，因为它将成为<code>feign.Decoder</code>、<code>feign.Encoder</code>、<code>feign.Contract</code>等的默认来源。这可以通过把它放在一个单独的、与任何<code>@ComponentScan</code>或<code>@SpringBootApplication</code>不重叠的包中来避免，或者可以在<code>@ComponentScan</code>中明确地排除它。</p>
</blockquote>
<blockquote>
<p>使用<code>@FeignClient</code>注解的<code>contextId</code>属性，除了改变<code>ApplicationContext</code>集合的名称外，它将覆盖客户端名称的别名，它将作为为该客户端创建的配置Bean名称的一部分。</p>
</blockquote>
<p><strong>以前，使用<code>url</code>属性，不需要<code>name</code>属性。现在使用<code>name</code>是必须的</strong>。</p>
<p>在<code>name</code>和<code>url</code>属性中支持占位符。</p>
<pre><code class="language-java">@FeignClient(name = &quot;${feign.name}&quot;, url = &quot;${feign.url}&quot;)
public interface StoreClient {
    //..
}
</code></pre>
<p>Spring Cloud OpenFeign默认为feign提供了以下bean（ <code>BeanType</code> beanName: <code>ClassName</code> ）。</p>
<ul>
<li><code>Decoder</code> feignDecoder: <code>ResponseEntityDecoder</code> (它包装了一个<code>SpringDecoder</code> )</li>
<li><code>Encoder</code> feignEncoder: <code>SpringEncoder</code>。</li>
<li><code>Logger</code> feignLogger: &quot;Slf4jLogger&quot;.</li>
<li><code>MicrometerCapability</code> micrometerCapability: 如果<code>feign-micrometer</code>在classpath上并且<code>MeterRegistry</code>是可用的</li>
<li><code>Contract</code> feignContract: <code>SpringMvcContract</code>。</li>
<li><code>Feign.Builder</code> feignBuilder: &quot;FeignCircuitBreaker.Builder&quot;。</li>
<li><code>Client</code> feignClient: 如果Spring Cloud LoadBalancer在classpath上，就会使用<code>FeignBlockingLoadBalancerClient</code>。如果它们都不在classpath上，则使用默认的feign客户端。</li>
</ul>
<blockquote>
<p><code>spring-cloud-starter-openfeign</code>支持<code>spring-cloud-starter-loadbalancer</code>。然而，由于它是一个可选的依赖关系，如果你想使用它，你需要确保它被添加到你的项目中。</p>
</blockquote>
<p>OkHttpClient和ApacheHttpClient以及ApacheHC5 feign客户端可以通过设置<code>feign.okhttp.enabled</code>或<code>feign.httpclient.enabled</code>或<code>feign.httpclient.hc5.enabled</code>分别为<code>true</code>，并将它们放在classpath上。你可以自定义使用的HTTP客户端，当使用Apache时提供<code>org.apache.http.impl.client.CloseableHttpClient</code>，当使用OK HTTP时提供<code>okhttp3.OkHttpClient</code>，当使用Apache HC5时提供<code>org.apache.hc.client5.http.impl.classic.CloseableHttpClient</code>的Bean。</p>
<p>Spring Cloud OpenFeign <em>不</em>为feign提供以下Bean，但仍然从应用上下文中查找这些类型的Bean来创建feign客户端。</p>
<ul>
<li><code>Logger.Level</code></li>
<li><code>Retryer</code></li>
<li><code>ErrorDecoder</code></li>
<li><code>Request.Options</code></li>
<li><code>Collection&lt;RequestInterceptor&gt;</code></li>
<li><code>SetterFactory</code></li>
<li><code>QueryMapEncoder</code></li>
<li><code>Capability</code> (默认提供<code>MicrometerCapability</code>)</li>
</ul>
<p>默认情况下，创建一个类型为<code>Retryer.NEVER_RETRY</code>的bean，它将禁止重试。注意这个重试行为与Feign的默认行为不同，它将自动重试IOExceptions，将其视为瞬时网络相关的异常，以及从ErrorDecoder抛出的任何RetryableException。</p>
<p>创建一个这些类型的Bean，并将其放置在<code>@FeignClient</code>配置中（如上面的<code>FooConfiguration</code>），允许你覆盖所述的每一个Bean。</p>
<p>Example</p>
<pre><code class="language-java">@Configuration
public class FooConfiguration {
    @Bean
    public Contract feignContract() {
        return new feign.Contract.Default();
    }

    @Bean
    public BasicAuthRequestInterceptor basicAuthRequestInterceptor() {
        return new BasicAuthRequestInterceptor(&quot;user&quot;, &quot;password&quot;);
    }
}
</code></pre>
<p>这就用<code>feign.Contract.Default</code>替换了<code>SpringMvcContract</code>，并在<code>RequestInterceptor</code>的集合中添加了一个<code>RequestInterceptor</code>。</p>
<p><code>@FeignClient</code>也可以使用配置属性进行配置。</p>
<p>application.yml</p>
<pre><code class="language-yaml">feign:
    client:
        config:
            feignName:
                connectTimeout: 5000
                readTimeout: 5000
                loggerLevel: full
                errorDecoder: com.example.SimpleErrorDecoder
                retryer: com.example.SimpleRetryer
                defaultQueryParameters:
                    query: queryValue
                defaultRequestHeaders:
                    header: headerValue
                requestInterceptors:
                    - com.example.FooRequestInterceptor
                    - com.example.BarRequestInterceptor
                decode404: false
                encoder: com.example.SimpleEncoder
                decoder: com.example.SimpleDecoder
                contract: com.example.SimpleContract
                capabilities:
                    - com.example.FooCapability
                    - com.example.BarCapability
                metrics.enabled: false
</code></pre>
<p>默认配置可以在<code>@EnableFeignClients</code>属性<code>defaultConfiguration</code>中指定，其方式与上述类似。不同的是，这个配置将适用于<em>所有</em>feign客户。</p>
<p>如果你喜欢使用配置属性来配置所有的<code>@FeignClient</code>，你可以创建带有<code>default</code>feign名称的配置属性。</p>
<p>你可以使用<code>feign.client.config.feignName.defaultQueryParameters</code>和<code>feign.client.config.feignName.defaultRequestHeaders</code>来指定查询参数和头信息，这些参数将在每个名为<code>feignName</code>的客户端的请求中发送。</p>
<p>application.yml</p>
<pre><code class="language-yaml">feign:
    client:
        config:
            default:
                connectTimeout: 5000
                readTimeout: 5000
                loggerLevel: basic
</code></pre>
<p>如果我们同时创建了<code>@Configuration</code>bean和配置属性，配置属性将获胜。它将覆盖<code>@Configuration</code>的值。但如果你想改变优先级为<code>@Configuration</code>，你可以把<code>feign.client.default-to-properties</code>改为<code>false</code>。</p>
<p>如果我们想创建多个具有相同名称或网址的feign客户端，使它们指向同一个服务器，但每个客户端都有不同的自定义配置，那么我们必须使用<code>@FeignClient</code>的<code>contextId</code>属性，以避免这些配置Bean的名称冲突。</p>
<pre><code class="language-java">@FeignClient(contextId = &quot;fooClient&quot;, name = &quot;stores&quot;, configuration = FooConfiguration.class)
public interface FooClient {
    //..
}
</code></pre>
<pre><code class="language-java">@FeignClient(contextId = &quot;barClient&quot;, name = &quot;stores&quot;, configuration = BarConfiguration.class)
public interface BarClient {
    //..
}
</code></pre>
<p>也可以配置FeignClient不继承父环境的bean。你可以通过重写<code>inheritParentConfiguration()</code>在<code>FeignClientConfigurer</code>bean中返回<code>false</code>来实现。</p>
<pre><code class="language-java">@Configuration
public class CustomConfiguration{

@Bean
public FeignClientConfigurer feignClientConfigurer() {
            return new FeignClientConfigurer() {

                @Override
                public boolean inheritParentConfiguration() {
                    return false;
                }
            };

        }
}
</code></pre>
<blockquote>
<p>默认情况下，Feign客户端不对斜线<code>/</code>字符进行编码。你可以通过设置<code>feign.client.decodeSlash</code>的值为<code>false</code>来改变这一行为。</p>
</blockquote>
<h4 id="121-springencoder-configuration"><a class="header" href="#121-springencoder-configuration">1.2.1. SpringEncoder configuration</a></h4>
<p>在我们提供的 <code>SpringEncoder</code> 中，我们为二进制内容类型设置了 <code>null</code> 字符集，为所有其他类型设置了 <code>UTF-8</code>。</p>
<p>你可以通过设置<code>feign.encoder.charset-from-content-type</code>的值为<code>true</code>来修改这一行为，从<code>Content-Type</code>头的字符集中获得字符集。</p>
<h3 id="13-超时处理"><a class="header" href="#13-超时处理">1.3. 超时处理</a></h3>
<p>我们可以在默认客户端和命名客户端上配置超时。OpenFeign使用两个超时参数。</p>
<ul>
<li><code>connectTimeout</code>防止因服务器处理时间过长而阻塞调用者。</li>
<li><code>readTimeout</code>从连接建立时开始应用，当返回响应的时间过长时触发。</li>
</ul>
<blockquote>
<p>如果服务器没有运行或可用，数据包的结果是<em>connection refused</em>。通信会以错误信息或回退的方式结束。如果 <code>connectTimeout</code> 设置得很低，这可能会在它之前发生。执行查找和接收这种数据包所需的时间导致了这一延迟的重要部分。它可以根据涉及DNS查询的远程主机而改变。</p>
</blockquote>
<h3 id="14-手动创建feign客户端"><a class="header" href="#14-手动创建feign客户端">1.4. 手动创建Feign客户端</a></h3>
<p>在某些情况下，可能需要对你的Feign客户进行定制，而使用上述方法是不可能的。在这种情况下，你可以使用<a href="https://github.com/OpenFeign/feign/#basics">Feign Builder API</a>创建客户端。下面是一个例子，它创建了两个具有相同接口的Feign客户端，但每个客户端都配置了一个单独的请求拦截器。</p>
<pre><code class="language-java">@Import(FeignClientsConfiguration.class)
class FooController {

    private FooClient fooClient;

    private FooClient adminClient;

    @Autowired
    public FooController(Client client, Encoder encoder, Decoder decoder, Contract contract, MicrometerCapability micrometerCapability) {
        this.fooClient = Feign.builder().client(client)
                .encoder(encoder)
                .decoder(decoder)
                .contract(contract)
                .addCapability(micrometerCapability)
                .requestInterceptor(new BasicAuthRequestInterceptor(&quot;user&quot;, &quot;user&quot;))
                .target(FooClient.class, &quot;https://PROD-SVC&quot;);

        this.adminClient = Feign.builder().client(client)
                .encoder(encoder)
                .decoder(decoder)
                .contract(contract)
                .addCapability(micrometerCapability)
                .requestInterceptor(new BasicAuthRequestInterceptor(&quot;admin&quot;, &quot;admin&quot;))
                .target(FooClient.class, &quot;https://PROD-SVC&quot;);
    }
}
</code></pre>
<blockquote>
<p>在上面的例子中，<code>FeignClientsConfiguration.class</code>是由Spring Cloud OpenFeign提供的默认配置。</p>
</blockquote>
<blockquote>
<p><code>PROD-SVC</code>是客户将向其发出请求的服务名称。</p>
</blockquote>
<blockquote>
<p>Feign <code>Contract</code>对象定义了哪些注解和值对接口有效。自动连接的<code>Contract</code>bean提供了对SpringMVC注释的支持，而不是默认的Feign本地注释。</p>
</blockquote>
<blockquote>
<p>你也可以使用<code>Builder</code>来配置FeignClient不从父级上下文中继承bean。你可以通过覆盖调用<code>Builder</code>上的<code>inheritParentContext(false)</code>来做到这一点。</p>
</blockquote>
<h3 id="15-feign-spring-cloud-断路器"><a class="header" href="#15-feign-spring-cloud-断路器">1.5. Feign Spring Cloud 断路器</a></h3>
<p>如果Spring Cloud CircuitBreaker在classpath上，并且<code>feign.circuitbreaker.enabled=true</code>，Feign将用断路器来包装所有方法。</p>
<p>要在每个客户的基础上禁用Spring Cloud CircuitBreaker的支持，需要创建一个vanilla <code>Feign.Builder</code>，其范围为 <code>prototype</code>，例如。</p>
<pre><code class="language-java">@Configuration
public class FooConfiguration {
    @Bean
    @Scope(&quot;prototype&quot;)
    public Feign.Builder feignBuilder() {
        return Feign.builder();
    }
}
</code></pre>
<p>断路器的名称遵循这种模式<code>&lt;feignClientName&gt;#&lt;calledMethod&gt;</code>。当调用名称为 <code>foo</code> 的<code>@FeignClient</code> 时，被调用的接口方法为 <code>bar</code>，那么断路器的名称将是 <code>foo_bar</code>。</p>
<p>要启用Spring Cloud CircuitBreaker组，请设置<code>feign.circuitbreaker.group.enabled</code>属性为<code>true</code>（默认为<code>false</code>）。</p>
<h3 id="16-feign-spring-cloud-断路器熔断"><a class="header" href="#16-feign-spring-cloud-断路器熔断">1.6. Feign Spring Cloud 断路器熔断</a></h3>
<p>Spring Cloud CircuitBreaker支持<code>fallback</code>的概念：一个默认的代码路径，在电路打开或出现错误时执行。要为一个给定的<code>@FeignClient</code>启用回退，将<code>fallback</code>属性设置为实现回退的类名。你还需要将你的实现声明为一个Spring Bean。</p>
<pre><code class="language-java">@FeignClient(name = &quot;test&quot;, url = &quot;http://localhost:${server.port}/&quot;, fallback = Fallback.class)
    protected interface TestClient {

        @RequestMapping(method = RequestMethod.GET, value = &quot;/hello&quot;)
        Hello getHello();

        @RequestMapping(method = RequestMethod.GET, value = &quot;/hellonotfound&quot;)
        String getException();

    }

    @Component
    static class Fallback implements TestClient {

        @Override
        public Hello getHello() {
            throw new NoFallbackAvailableException(&quot;Boom!&quot;, new RuntimeException());
        }

        @Override
        public String getException() {
            return &quot;Fixed response&quot;;
        }

    }
</code></pre>
<p>如果需要访问触发<code>fallback</code>的原因，可以使用<code>@FeignClient</code>里面的<code>fallbackFactory</code>属性。</p>
<pre><code class="language-java">@FeignClient(name = &quot;testClientWithFactory&quot;, url = &quot;http://localhost:${server.port}/&quot;,
            fallbackFactory = TestFallbackFactory.class)
    protected interface TestClientWithFactory {

        @RequestMapping(method = RequestMethod.GET, value = &quot;/hello&quot;)
        Hello getHello();

        @RequestMapping(method = RequestMethod.GET, value = &quot;/hellonotfound&quot;)
        String getException();

    }

    @Component
    static class TestFallbackFactory implements FallbackFactory&lt;FallbackWithFactory&gt; {

        @Override
        public FallbackWithFactory create(Throwable cause) {
            return new FallbackWithFactory();
        }

    }

    static class FallbackWithFactory implements TestClientWithFactory {

        @Override
        public Hello getHello() {
            throw new NoFallbackAvailableException(&quot;Boom!&quot;, new RuntimeException());
        }

        @Override
        public String getException() {
            return &quot;Fixed response&quot;;
        }

    }
</code></pre>
<h3 id="17-feign-和-primary"><a class="header" href="#17-feign-和-primary">1.7. Feign 和 @Primary</a></h3>
<p>当使用Feign与Spring Cloud CircuitBreaker回退时，<code>ApplicationContext</code>中有多个相同类型的bean。这将导致<code>@Autowired</code>不工作，因为没有确切的一个bean，或一个被标记为主要的bean。为了解决这个问题，Spring Cloud OpenFeign将所有Feign实例标记为<code>@Primary</code>，这样Spring Framework就知道要注入哪个bean。在某些情况下，这可能是不可取的。要关闭这种行为，请将<code>@FeignClient</code>的<code>primary</code>属性设置为false。</p>
<pre><code class="language-java">@FeignClient(name = &quot;hello&quot;, primary = false)
public interface HelloClient {
    // methods here
}
</code></pre>
<h3 id="18-feign-支持继承"><a class="header" href="#18-feign-支持继承">1.8. Feign 支持继承</a></h3>
<p>Feign通过单继承接口支持模板式的apis。这允许将常见的操作归入方便的基础接口。</p>
<p>UserService.java</p>
<pre><code class="language-java">public interface UserService {

    @RequestMapping(method = RequestMethod.GET, value =&quot;/users/{id}&quot;)
    User getUser(@PathVariable(&quot;id&quot;) long id);
}
</code></pre>
<p>UserResource.java</p>
<pre><code class="language-java">@RestController
public class UserResource implements UserService {

}
</code></pre>
<p>UserClient.java</p>
<pre><code class="language-java">package project.user;

@FeignClient(&quot;users&quot;)
public interface UserClient extends UserService {

}
</code></pre>
<blockquote>
<p>一般来说，在服务器和客户端之间共享一个接口是不可取的。它引入了紧耦合，而且实际上在目前的形式下也不能与Spring MVC一起工作（方法参数映射不被继承）。</p>
</blockquote>
<h3 id="19-feign-请求响应-压缩"><a class="header" href="#19-feign-请求响应-压缩">1.9. Feign 请求/响应 压缩</a></h3>
<p>你可以考虑为你的Feign请求启用请求或响应的GZIP压缩。你可以通过启用其中一个属性来做到这一点。</p>
<pre><code class="language-properties">feign.compression.request.enabled=true
feign.compression.response.enabled=true
</code></pre>
<p>Feign请求压缩给你的设置与你可能为你的网络服务器设置的类似。</p>
<pre><code class="language-properties">feign.compression.request.enabled=true
feign.compression.request.mime-types=text/xml,application/xml,application/json
feign.compression.request.min-request-size=2048
</code></pre>
<p>这些属性允许你对压缩的媒体类型和最小请求阈值长度进行选择。</p>
<p>对于除OkHttpClient以外的http客户端，可以启用默认的gzip解码器，以UTF-8编码解码gzip响应。</p>
<pre><code class="language-properties">feign.compression.response.enabled=true
feign.compression.response.useGzipDecoder=true
</code></pre>
<h3 id="110-feign-日志"><a class="header" href="#110-feign-日志">1.10. Feign 日志</a></h3>
<p>每个创建的Feign客户端都会创建一个记录器。默认情况下，日志记录器的名称是用于创建Feign客户端的接口的全类名称。Feign的日志只对<code>DEBUG</code>级别做出响应。</p>
<p>application.yml</p>
<pre><code class="language-yaml">logging.level.project.user.UserClient: DEBUG
</code></pre>
<p>你可以为每个客户配置<code>Logger.Level</code>对象，告诉Feign要记录多少。选择是。</p>
<ul>
<li><code>NONE</code> , 不记录(<strong>DEFAULT</strong>)。
<code>BASIC</code> , 只记录请求方法和URL以及响应状态代码和执行时间。</li>
<li><code>HEADERS</code> , 记录基本信息以及请求和响应头信息。</li>
<li><code>FULL</code> , 记录请求和响应的头信息、正文和元数据。</li>
</ul>
<p>例如，下面将设置<code>Logger.Level</code>为<code>FULL</code>。</p>
<pre><code class="language-java">@Configuration
public class FooConfiguration {
    @Bean
    Logger.Level feignLoggerLevel() {
        return Logger.Level.FULL;
    }
}
</code></pre>
<h3 id="111-feign-capability-支持"><a class="header" href="#111-feign-capability-支持">1.11. Feign Capability 支持</a></h3>
<p>Feign的能力暴露了Feign的核心组件，因此这些组件可以被修改。例如，这些功能可以使用 <code>Client</code>，对其进行<em>装饰</em>，并将装饰后的实例反馈给Feign。对<code>metrics libraries</code>的支持就是一个很好的现实例子。参见<a href="https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/#feign-metrics">Feign metrics</a>。</p>
<p>创建一个或多个 <code>Capability</code> Bean，并把它们放在<code>@FeignClient</code> 配置中，可以让你注册它们并修改相关客户端的行为。</p>
<pre><code class="language-java">@Configuration
public class FooConfiguration {
    @Bean
    Capability customCapability() {
        return new CustomCapability();
    }
}
</code></pre>
<h3 id="112-feign-metrics"><a class="header" href="#112-feign-metrics">1.12. Feign metrics</a></h3>
<p>如果以下条件都是<code>true</code>，一个<code>MicrometerCapability</code>bean就会被创建和注册，这样你的Feign客户端就会向<code>Micrometer</code>发布<code>metrics</code>。</p>
<ul>
<li><code>feign-micrometer</code>在classpath上</li>
<li><code>MeterRegistry</code> bean是可用的</li>
<li>feign metrics properties设置为<code>true</code>（默认）
<ul>
<li><code>feign.metrics.enabled=true</code> (对于所有客户端)</li>
<li><code>feign.client.config.feignName.metrics.enabled=true</code> (对于单个客户端)</li>
</ul>
</li>
</ul>
<blockquote>
<p>如果你的应用程序已经使用了Micrometer，启用<code>metrics</code>就像把<code>feign-micrometer</code>放到classpath上一样简单。</p>
</blockquote>
<p>你也可以通过以下方式禁用该功能。</p>
<ul>
<li>从你的classpath中排除<code>feign-micrometer</code>。</li>
<li>将feign的一个metrics properties设置为 &quot;false&quot;。
<ul>
<li><code>feign.metrics.enabled=false</code></li>
<li><code>feign.client.config.feignName.metrics.enabled=false</code></li>
</ul>
</li>
</ul>
<blockquote>
<p><code>feign.metrics.enabled=false</code> 禁用对<strong>所有</strong>Feign客户端的<code>metrics</code>支持，而不考虑客户端级别的标志值。<code>feign.client.config.feignName.metrics.enabled</code> 。如果你想启用或禁用每个客户端的merics，不要设置<code>feign.metrics.enabled</code>，使用<code>feign.client.config.feignName.metrics.enabled</code>。</p>
</blockquote>
<p>你也可以通过注册你自己的bean来定制<code>MicrometerCapability</code>。</p>
<pre><code class="language-java">@Configuration
public class FooConfiguration {
    @Bean
    public MicrometerCapability micrometerCapability(MeterRegistry meterRegistry) {
        return new MicrometerCapability(meterRegistry);
    }
}
</code></pre>
<h3 id="113--feign-querymap-support"><a class="header" href="#113--feign-querymap-support">1.13.  Feign @QueryMap support</a></h3>
<p>OpenFeign <code>@QueryMap</code>注解提供了对POJO的支持，可用作GET参数映射。不幸的是，默认的OpenFeign QueryMap注解与Spring不兼容，因为它缺少一个<code>value</code>属性。</p>
<p>Spring Cloud OpenFeign提供了一个等价的<code>@SpringQueryMap</code>注解，用于注解一个POJO或Map参数作为查询参数地图。</p>
<p>例如，<code>Params</code>类定义了参数<code>param1</code>和<code>param2</code>。</p>
<pre><code class="language-java">// Params.java
public class Params {
    private String param1;
    private String param2;

    // [Getters and setters omitted for brevity]
}
</code></pre>
<p>下面的feign客户端通过使用<code>@SpringQueryMap</code>注解来使用<code>Params</code>类。</p>
<pre><code class="language-java">@FeignClient(&quot;demo&quot;)
public interface DemoTemplate {

    @GetMapping(path = &quot;/demo&quot;)
    String demoEndpoint(@SpringQueryMap Params params);
}
</code></pre>
<p>如果你需要对生成的查询参数图有更多的控制，你可以实现一个自定义的<code>QueryMapEncoder</code>bean。</p>
<h3 id="114-hateoas-support"><a class="header" href="#114-hateoas-support">1.14. HATEOAS support</a></h3>
<p>Spring提供了一些API来创建遵循<a href="https://en.wikipedia.org/wiki/HATEOAS">HATEOAS</a>原则的REST表示，<a href="https://spring.io/projects/spring-hateoas">Spring Hateoas</a>和<a href="https://spring.io/projects/spring-data-rest">Spring Data REST</a>。</p>
<p>如果你的项目使用<code>org.springframework.boot:spring-boot-starter-hateoas</code>启动器或<code>org.springframework.boot:spring-boot-starter-data-rest</code>启动器，Feign HATEOAS支持默认为启用。</p>
<p>当HATEOAS支持被启用时，Feign客户端被允许序列化和反序列化HATEOAS表示模型。<a href="https://docs.spring.io/spring-hateoas/docs/1.0.0.M1/apidocs/org/springframework/hateoas/EntityModel.html">EntityModel</a>, <a href="https://docs.spring.io/spring-hateoas/docs/1.0.0.M1/apidocs/org/springframework/hateoas/CollectionModel.html">CollectionModel</a> 和 <a href="https://docs.spring.io/spring-hateoas/docs/1.0.0.M1/apidocs/org/springframework/hateoas/PagedModel.html">PagedModel</a>。</p>
<pre><code class="language-java">@FeignClient(&quot;demo&quot;)
public interface DemoTemplate {

    @GetMapping(path = &quot;/stores&quot;)
    CollectionModel&lt;Store&gt; getStores();
}
</code></pre>
<h3 id="115-spring-matrixvariable-support"><a class="header" href="#115-spring-matrixvariable-support">1.15. Spring @MatrixVariable Support</a></h3>
<p>Spring Cloud OpenFeign提供对Spring <code>@MatrixVariable</code>注解的支持。</p>
<p>如果一个Map被作为方法参数传递，<code>@MatrixVariable</code>路径段是通过用<code>=</code>连接地图中的键值对而创建的。</p>
<p>如果传递的是不同的对象，那么<code>@MatrixVariable</code>注解中提供的<code>name</code>（如果定义了的话）或者注解的变量名将用`=·与提供的方法参数连接。</p>
<p>重要提示</p>
<p>即使在服务器端，Spring并不要求用户将路径段占位符的名称与矩阵变量的名称相同，因为这在客户端太模糊了，Spring Cloud OpenFeign要求你添加一个路径段占位符，其名称与<code>@MatrixVariable</code>注解（如果定义了）中提供的<code>name</code>或注释变量的名称一致。</p>
<p>For example:</p>
<pre><code class="language-java">@GetMapping(&quot;/objects/links/{matrixVars}&quot;)
Map&lt;String, List&lt;String&gt;&gt; getObjects(@MatrixVariable Map&lt;String, List&lt;String&gt;&gt; matrixVars);
</code></pre>
<p>注意，变量名和路径段占位符都被称为<code>matrixVars</code>。</p>
<pre><code class="language-java">@FeignClient(&quot;demo&quot;)
public interface DemoTemplate {

    @GetMapping(path = &quot;/stores&quot;)
    CollectionModel&lt;Store&gt; getStores();
}
</code></pre>
<h3 id="116-feign-collectionformat-support"><a class="header" href="#116-feign-collectionformat-support">1.16. Feign CollectionFormat support</a></h3>
<p>我们通过提供<code>@CollectionFormat</code>注解来支持<code>feign.CollectionFormat</code>。你可以通过传递所需的<code>feign.CollectionFormat</code>作为注解值，用它来注解一个Feign客户端方法。</p>
<p>在下面的例子中，使用<code>CSV</code>格式而不是默认的<code>EXPLODED</code>来处理该方法。</p>
<pre><code class="language-java">@FeignClient(name = &quot;demo&quot;)
    protected interface PageableFeignClient {

        @CollectionFormat(feign.CollectionFormat.CSV)
        @GetMapping(path = &quot;/page&quot;)
        ResponseEntity performRequest(Pageable page);

    }
</code></pre>
<blockquote>
<p>在发送<code>Pageable</code>作为查询参数时设置<code>CSV</code>格式，以便正确编码。</p>
</blockquote>
<h3 id="117-reactive-support"><a class="header" href="#117-reactive-support">1.17. Reactive Support</a></h3>
<p>由于<a href="https://github.com/OpenFeign/feign">OpenFeign项目</a>目前不支持Reactive客户端，如<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/reactive/function/client/WebClient.html">Spring WebClient</a>，Spring Cloud OpenFeign也不支持。一旦核心项目中出现，我们将在此添加对它的支持。</p>
<p>在这之前，我们建议使用<a href="https://github.com/Playtika/feign-reactive">feign-reactive</a>来支持Spring WebClient。</p>
<h4 id="1171-早期初始化错误"><a class="header" href="#1171-早期初始化错误">1.17.1. 早期初始化错误</a></h4>
<p>根据你使用Feign客户端的方式，你可能在启动应用程序时看到初始化错误。为了解决这个问题，你可以在自动连接你的客户端时使用<code>ObjectProvider</code>。</p>
<pre><code class="language-java">@Autowired
ObjectProvider&lt;TestFeginClient&gt; testFeginClient;
</code></pre>
<h3 id="118-spring-data-support"><a class="header" href="#118-spring-data-support">1.18. Spring Data Support</a></h3>
<p>你可以考虑为支持<code>org.springframework.data.domain.Page</code>和<code>org.springframework.data.domain.Sort</code>解码而启用<code>Jackson</code>模块。</p>
<pre><code class="language-properties">feign.autoconfiguration.jackson.enabled=true
</code></pre>
<h3 id="119-spring-refreshscope-support"><a class="header" href="#119-spring-refreshscope-support">1.19. Spring @RefreshScope Support</a></h3>
<p>如果启用了Feign client refresh，每个feign客户端都是以<code>feign.Request.Options</code>作为刷新范围的bean来创建的。这意味着诸如<code>connectTimeout</code>和<code>readTimeout</code>等属性可以通过<code>POST /actuator/refresh</code>对任何Feign客户端实例进行刷新。</p>
<p>默认情况下，Feign客户端的刷新行为是禁用的。使用以下属性来启用刷新行为。</p>
<pre><code class="language-properties">feign.client.refresh-enabled=true
</code></pre>
<blockquote>
<p><strong>不要用</strong> <code>@RefreshScope</code> 注解来注释<code>@FeignClient</code>接口。</p>
</blockquote>
<h2 id="2-配置属性"><a class="header" href="#2-配置属性">2. 配置属性</a></h2>
<p>要查看所有Spring Cloud OpenFeign相关的配置属性列表，请查看<a href="https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/appendix.html">附录页面</a>。</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="license" /></a></p>
<p>本作品采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../spring-cloud/spring-cloud-open-service-broker.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../spring-cloud/spring-cloud-pipelines.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../spring-cloud/spring-cloud-open-service-broker.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../spring-cloud/spring-cloud-pipelines.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
                <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
                <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
