<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Spring Cloud Netflix</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Spring,SpringBoot,SpringCloudæœ€æ–°ä¸­æ–‡æ–‡æ¡£">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../index.html">Springä¸­æ–‡æ–‡æ¡£</a></li><li class="chapter-item "><a href="../spring-boot/index.html">Spring Boot</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-boot/getting-started.html">å¼€å§‹ä½¿ç”¨</a></li><li class="chapter-item "><a href="../spring-boot/upgrading.html">å‡çº§spring-bootåº”ç”¨</a></li><li class="chapter-item "><a href="../spring-boot/using.html">ä½¿ç”¨spring-boot</a></li><li class="chapter-item "><a href="../spring-boot/features.html">SringBootç‰¹æ€§</a></li><li class="chapter-item "><a href="../spring-boot/actuator.html">Spring Boot Actuator</a></li><li class="chapter-item "><a href="../spring-boot/cli.html">Spring Boot CLI</a></li><li class="chapter-item "><a href="../spring-boot/deployment.html">éƒ¨ç½²spring-bootåº”ç”¨</a></li><li class="chapter-item "><a href="../spring-boot/build-tool-plugins.html">æ„å»ºå·¥å…·æ’ä»¶</a></li><li class="chapter-item "><a href="../spring-boot/howto.html">â€œHow-toâ€æŒ‡å—</a></li><li class="chapter-item "><a href="../spring-boot/application-properties.html">Application Properties</a></li><li class="chapter-item "><a href="../spring-boot/configuration-metadata.html">Configuration Metadata</a></li><li class="chapter-item "><a href="../spring-boot/auto-configuration-classes.html">Auto-configuration classes</a></li><li class="chapter-item "><a href="../spring-boot/test-auto-configuration.html">Test auto-configuration annotations</a></li><li class="chapter-item "><a href="../spring-boot/executable-jar.html">å¯æ‰§è¡ŒJar</a></li><li class="chapter-item "><a href="../spring-boot/dependency-versions.html">ä¾èµ–ç‰ˆæœ¬å·</a></li></ol></li><li class="chapter-item expanded "><a href="../spring-cloud/index.html">Spring Cloud</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-cloud/spring-cloud-azure.html">Spring Cloud Azure</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-alibaba.html">Spring Cloud Alibaba</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-for-amazon-web-services.html">Spring Cloud for Amazon Web Services</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-bus.html">Spring Cloud Bus</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-circuit-breaker.html">Spring Cloud Circuit Breaker</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-cli.html">Spring Cloud CLI</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-for-cloud-foundry.html">Spring Cloud for Cloud Foundry</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-cloud-foundry-service-nroker.html">Spring Cloud - Cloud Foundry Service Broker</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-cluster.html">Spring Cloud Cluster</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-commons.html">Spring Cloud Commons</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-config.html">Spring Cloud Config</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-cconnectors.html">Spring Cloud Connectors</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-consul.html">Spring Cloud Consul</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-contract.html">Spring Cloud Contract</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-function.html">Spring Cloud Function</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-gateway.html">Spring Cloud Gateway</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-gcp.html">Spring Cloud GCP</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-kubernetes.html">Spring Cloud Kubernetes</a></li><li class="chapter-item expanded "><a href="../spring-cloud/spring-cloud-netflix].html" class="active">Spring Cloud Netflix</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-open-service-broker.html">Spring Cloud Open Service Broker</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-openfeign.html">Spring Cloud OpenFeign</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-pipelines.html">Spring Cloud Pipelines</a></li><li class="chapter-item "><a href="../spring-cloud-schema-registry.html">Spring Cloud Schema Registry</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-security.html">Spring Cloud Security</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-skipper.html">Spring Cloud Skipper</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth.html">Spring Cloud Sleuth</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/getting-started.html">å…¥é—¨ä½¿ç”¨</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/using.html">ä½¿ç”¨ Spring Cloud Sleuth</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/features.html">Spring Cloud Sleuth ç‰¹æ€§</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/howto.html">â€œHow-toâ€ æŒ‡å—</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/sleuth-integration.html">Spring Cloud Sleuth æ•´åˆ</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-sleuth/appendix.html">é™„å½•</a></li></ol></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream.html">Spring Cloud Stream</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-reference.html">Overview</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-binder-rabbit.html">Rabbit MQ Binder</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-binder-kafka.html">Apache Kafka Binder</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-binder-kafka.html">Apache Kafka Streams Binder</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream/spring-cloud-stream-samples.html">Spring Cloud Stream Samples</a></li></ol></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream-app-starters.html">Spring Cloud Stream App Starters</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-stream-applications.html">Spring Cloud Stream Applications</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-task.html">Spring Cloud Task</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-task-app-starters.html">Spring Cloud Task App Starters</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-vault.html">Spring Cloud Vault</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-zookeeper.html">Spring Cloud Zookeeper</a></li><li class="chapter-item "><a href="../spring-cloud/spring-cloud-app-broker.html">Spring Cloud App Broker</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="spring-cloud-netflix"><a class="header" href="#spring-cloud-netflix">Spring Cloud Netflix</a></h1>
<ul>
<li>å½“å‰ç‰ˆæœ¬ï¼š3.0.3</li>
<li>ä¿®æ”¹æ—¶é—´ï¼š2021å¹´7æœˆ22æ—¥</li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-cloud-netflix/docs/current/reference/html/">https://docs.spring.io/spring-cloud-netflix/docs/current/reference/html/</a></li>
<li>æºç ä»“åº“ï¼š<a href="https://github.com/spring-cloud/spring-cloud-netflix">https://github.com/spring-cloud/spring-cloud-netflix</a></li>
</ul>
<p>Spring Cloud Netflixé€šè¿‡è‡ªåŠ¨é…ç½®å’Œç»‘å®šåˆ°Springç¯å¢ƒå’Œå…¶ä»–Springç¼–ç¨‹æ¨¡å‹ä¹ è¯­ï¼Œä¸ºSpring Bootåº”ç”¨æä¾›äº†Netflix OSSé›†æˆã€‚é€šè¿‡ä¸€äº›ç®€å•çš„æ³¨é‡Šï¼Œæ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å¿«é€Ÿå¯ç”¨å’Œé…ç½®é€šç”¨æ¨¡å¼ï¼Œå¹¶ä½¿ç”¨ç»è¿‡å®æˆ˜è€ƒéªŒçš„Netflixç»„ä»¶æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æä¾›çš„æ¨¡å¼åŒ…æ‹¬æœåŠ¡å‘ç°(Eureka)ã€æ–­è·¯å™¨(Hystrix)ã€æ™ºèƒ½è·¯ç”±(Zuul)å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡(Ribbon)ã€‚</p>
<h2 id="1-æœåŠ¡å‘ç°eureka-clinet"><a class="header" href="#1-æœåŠ¡å‘ç°eureka-clinet">1. æœåŠ¡å‘ç°ï¼šEureka Clinet</a></h2>
<p>æœåŠ¡å‘ç°æ˜¯åŸºäºå¾®æœåŠ¡çš„ä½“ç³»ç»“æ„çš„å…³é”®åŸåˆ™ä¹‹ä¸€ã€‚å°è¯•æ‰‹åŠ¨é…ç½®æ¯ä¸ªå®¢æˆ·ç«¯æˆ–æŸç§å½¢å¼çš„çº¦å®šå¯èƒ½å¾ˆå›°éš¾ï¼Œè€Œä¸”å¯èƒ½æ˜“æŒ‚ã€‚Netflixçš„æœåŠ¡å‘ç°å™¨å’Œå®¢æˆ·ç«¯Eurekaï¼Œå¯ä»¥å°†æœåŠ¡å™¨é…ç½®å’Œéƒ¨ç½²ä¸ºé«˜å¯ç”¨æ€§ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½å¯ä»¥å°†å·²æ³¨å†ŒæœåŠ¡çš„çŠ¶æ€å¤åˆ¶ç»™å…¶ä»–æœåŠ¡å™¨ã€‚</p>
<h3 id="11-å¦‚ä½•å¼•å…¥eureka-client"><a class="header" href="#11-å¦‚ä½•å¼•å…¥eureka-client">1.1. å¦‚ä½•å¼•å…¥Eureka Client</a></h3>
<p>è¦åœ¨é¡¹ç›®ä¸­åŒ…å«Eureaka Clientï¼Œè¯·ä½¿ç”¨startä¸­gruop IDä¸º<code>org.springframework.cloud</code>å’Œartifact IDä¸º<code>spring-cloud-starter-netflix-eureka-client</code>çš„åŒ…ï¼Œæœ‰å…³ä½¿ç”¨Spring cloudè®¾ç½®æ„å»ºç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://spring.io/projects/spring-cloud">Spring Cloud Project</a>
é¡µé¢ã€‚</p>
<h3 id="12-å‘eurekaæ³¨å†ŒæœåŠ¡"><a class="header" href="#12-å‘eurekaæ³¨å†ŒæœåŠ¡">1.2. å‘Eurekaæ³¨å†ŒæœåŠ¡</a></h3>
<p>å½“å®¢æˆ·ç«¯å‘Eurekaæ³¨å†Œæ—¶ï¼Œå®ƒä¼šæä¾›å…³äºè‡ªèº«çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚ä¸»æœºã€ç«¯å£ã€å¥åº·çŠ¶æ€URlã€ä¸»é¡µå’Œå…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚Eurekaæ¥æ”¶æ¥è‡ªå±äºæŸä¸ªæœåŠ¡çš„æ¯ä¸ªå®ä¾‹çš„å¿ƒè·³æ¶ˆæ¯ã€‚å¦‚æœåœ¨å¯é…ç½®çš„æ—¶é—´å†…æ£€æµ‹å¿ƒè·³å¤±è´¥ï¼Œå®ä¾‹å®¢æˆ·ç«¯é€šå¸¸ä¼šä»æ³¨å†Œä¸­å¿ƒåˆ é™¤ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªæœ€å°çš„Eurekaå®¢æˆ·ç«¯åº”ç”¨ç¨‹åº:</p>
<pre><code class="language-java">@SpringBootApplication
@RestController
public class Application {

    @RequestMapping(&quot;/&quot;)
    public String home() {
        return &quot;Hello world&quot;;
    }

    public static void main(String[] args) {
        new SpringApplicationBuilder(Application.class).web(true).run(args);
    }

}
</code></pre>
<p>æ³¨æ„ï¼Œä¸Šé¢çš„ç¤ºä¾‹åªæ˜¯ä¸€ä¸ªæ™®é€šçš„Spring Bootåº”ç”¨ç¨‹åºã€‚é€šè¿‡åŒ…ç®¡ç†æ–‡ä»¶å¼•å…¥<code>spring-cloud-starter-netflix-Eureka-client</code>ä¾èµ–ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°†è‡ªåŠ¨æ³¨å†Œåˆ°Eureka Serverã€‚å®šä½ EurekaæœåŠ¡å™¨éœ€è¦é…ç½®ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p>
<p><strong>application.yml</strong></p>
<pre><code class="language-yml">eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/
</code></pre>
<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>defaultZone</code> æ˜¯ä¸€ä¸ªç¼ºçœå­—ç¬¦ä¸²å›è°ƒå€¼ï¼Œå®ƒä¸ºä»»ä½•ä¸å¡«å†™æ³¨å†Œä¸­å¿ƒåœ°å€çš„å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚(æ¢å¥è¯è¯´ï¼šä¸å¡«æ­¤é¡¹ï¼Œeurekaä½¿ç”¨http://localhost:8761/eureka/ä½œä¸ºé»˜è®¤åœ°å€)</p>
<blockquote>
<p>ğŸ“ è¿™ä¸ª<code>defaultZone</code>å±æ€§æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œå¹¶ä¸”éœ€è¦é©¼å³°å‘½ä»¤æ³•ï¼Œå› ä¸º<code>serviceUrl</code>å±æ€§æ˜¯<code>Map&lt;String, String&gt;</code>ã€‚å› æ­¤ï¼Œ<code>defaultZone</code>å±æ€§ä¸éµå¾ªå¸¸è§„Spring Bootè›‡å½¢å‘½åæ³•çº¦å®šã€‚</p>
</blockquote>
<p>é»˜è®¤çš„åº”ç”¨ç¨‹åºåç§°(å³æœåŠ¡ ID)ã€è™šæ‹Ÿä¸»æœºå’Œéå®‰å…¨ç«¯å£(å–è‡ªç¯å¢ƒ)åˆ†åˆ«ä¸º<code>${ spring.application.name }</code>ã€<code>${ spring.application.name }</code>å’Œ<code>${ server.port }</code>ã€‚</p>
<p>åœ¨åŒ…ç®¡ç†å·¥å…·ä¸­å¼•å…¥<code>spring-cloud-starter-netflix-Eureka-client</code>,ä½¿å¾—åº”ç”¨ç¨‹åºæ—¢æˆä¸ºEurekaç¤ºä¾‹ï¼Œä¹Ÿæˆä¸ºå®¢æˆ·ç«¯ï¼ˆå®ƒå¯ä»¥æŸ¥è¯¢æ³¨å†Œä¸­å¿ƒå®šä½å…¶ä»–æœåŠ¡ï¼‰ã€‚å®ä¾‹è¡Œä¸ºæ˜¯ç”±<code>euraka.instance.*</code>é…ç½®é©±åŠ¨çš„ï¼Œä½†æ˜¯ä½ è¦ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºé…ç½®<code>spring.application.name</code>å€¼ã€‚</p>
<blockquote>
<p>æœ‰å…³å¯é…ç½®é€‰é¡¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/main/spring-cloud-netflix-eureka-client/src/main/java/org/springframework/cloud/netflix/eureka/EurekaInstanceConfigBean.java">EurekaInstanceConfigBean</a>å’Œ<a href="https://github.com/spring-cloud/spring-cloud-netflix/tree/main/spring-cloud-netflix-eureka-client/src/main/java/org/springframework/cloud/netflix/eureka/EurekaClientConfigBean.java">EurekaClientConfigBean</a>ã€‚</p>
</blockquote>
<p>è¦ç¦ç”¨Eurekaå‘ç°å®¢æˆ·ç«¯ï¼Œä½ å¯ä»¥å°†<code>Eureka.Client.enabled</code>è®¾ç½®ä¸º<code>false</code>ã€‚å½“ <code>spring.cloud.Discovery.enabled</code>è®¾ç½®ä¸º<code>false</code>æ—¶ï¼ŒEurekaå‘ç°å®¢æˆ·ç«¯ä¹Ÿå°†è¢«ç¦ç”¨ã€‚</p>
<h3 id="13-åœ¨eureka-serverä¸ŠéªŒè¯"><a class="header" href="#13-åœ¨eureka-serverä¸ŠéªŒè¯">1.3 åœ¨Eureka serverä¸ŠéªŒè¯</a></h3>
<p>å¦‚æœ<code>eureka.client.serviceur.defaultzone</code>çš„Urlä¸­åµŒå…¥äº†å‡­æ®(curlæ ·å¼çš„ï¼Œç¤ºä¾‹ï¼šuser: password@localhost: 8761/eureka)ï¼ŒHTTPçš„åŸºæœ¬èº«ä»½éªŒè¯å°†è‡ªåŠ¨æ·»åŠ åˆ°Eurekaå®¢æˆ·æœºä¸­ã€‚å¯¹äºæ›´è´Ÿè½½çš„éœ€æ±‚ï¼Œä½ å¯ä»¥åˆ›å»ºç±»å‹ä¸ºï¼š<code>DiscoveryClientOptionalArgs</code> çš„<code>@bean</code>ï¼Œå¹¶å°†<code>ClientFilter</code>å®ä¾‹æ’å…¥å…¶ä¸­ï¼Œæ‰€æœ‰è¿™äº›éƒ½åº”ç”¨äºä»å®¢æˆ·æœºåˆ°æœåŠ¡å™¨çš„è°ƒç”¨ã€‚</p>
<p>å½“EurekaæœåŠ¡å™¨éœ€è¦å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œå®¢æˆ·ç«¯è¯ä¹¦å’Œä¿¡ä»»å­˜å‚¨å¯ä»¥é€šè¿‡å±æ€§è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p>
<p><strong>application.yml</strong></p>
<pre><code class="language-yml">eureka:
  client:
    tls:
      enabled: true
      key-store: &lt;path-of-key-store&gt;
      key-store-type: PKCS12
      key-store-password: &lt;key-store-password&gt;
      key-password: &lt;key-password&gt;
      trust-store: &lt;path-of-trust-store&gt;
      trust-store-type: PKCS12
      trust-store-password: &lt;trust-store-password&gt;
</code></pre>
<p>å¯ç”¨<code>Eureka.client.TLS.enabled </code>è¦ä¸ºtrueæ‰èƒ½å¯ç”¨Eurekaå®¢æˆ·ç«¯çš„TLSã€‚å½“çœç•¥<code>eurea.client.tls.trust-store</code>æ—¶ï¼Œå°†ä½¿ç”¨JVMé»˜è®¤ä¿¡ä»»å­˜å‚¨ã€‚<code>Eureka.client.tls.key-store-type</code>å’Œ<code>eureka.client.tls.trust-store-type</code>çš„é»˜è®¤å€¼æ˜¯ PKCS12ã€‚å¦‚æœçœç•¥å¯†ç å±æ€§ï¼Œåˆ™å‡å®šä¸ºç©ºå¯†ç ã€‚</p>
<blockquote>
<p>ç”±äº Eureka ä¸­çš„é™åˆ¶ï¼Œä¸å¯èƒ½æ”¯æŒæ¯ä¸ªæœåŠ¡å™¨çš„åŸºæœ¬æˆæƒå‡­è¯ï¼Œå› æ­¤åªä½¿ç”¨æ‰¾åˆ°çš„ç¬¬ä¸€ç»„å‡­è¯ã€‚</p>
</blockquote>
<p>å¦‚æœä½ æƒ³å®šåˆ¶Eureka HTTPå®¢æˆ·ç«¯ä½¿ç”¨çš„<code>RestTemplate</code>ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>EurekaClientHttpRequestFactorySupplier</code>ï¼Œå¹¶ç¼–å†™è‡ªå·±çš„é€»è¾‘æ¥ç”Ÿæˆ<code>ClientHttpRequestFactory</code>å®ä¾‹ã€‚</p>
<h3 id="14-çŠ¶æ€é¡µå’Œå¥åº·æŒ‡ç¤ºå™¨"><a class="header" href="#14-çŠ¶æ€é¡µå’Œå¥åº·æŒ‡ç¤ºå™¨">1.4 çŠ¶æ€é¡µå’Œå¥åº·æŒ‡ç¤ºå™¨</a></h3>
<p>Eureka å®ä¾‹çš„çŠ¶æ€é¡µé¢å’Œå¥åº·çŠ¶æ€æŒ‡ç¤ºå™¨åˆ†åˆ«é»˜è®¤ä¸º<code>/info</code> å’Œ<code>/health</code>ï¼Œè¿™æ˜¯Spring Boot Actuatoråº”ç”¨ç¨‹åºä¸­æœ‰ç”¨çš„ç«¯ç‚¹é»˜è®¤ä½ç½®ã€‚å¦‚æœä½¿ç”¨éé»˜è®¤çš„ä¸Šä¸‹æ–‡è·¯å¾„æˆ–servletè·¯å¾„(æ¯”å¦‚ server.servletPath =/custom) ï¼Œé‚£ä¹ˆå³ä½¿å¯¹äºå®ç°çš„åº”ç”¨ç¨‹åºä¹Ÿéœ€è¦ä¿®æ”¹è¿™äº›è·¯å¾„ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†è¿™ä¸¤ä¸ªè®¾ç½®çš„é»˜è®¤å€¼:</p>
<p><strong>application.yml</strong></p>
<pre><code class="language-yml">eureka:
  instance:
    statusPageUrlPath: ${server.servletPath}/info
    healthCheckUrlPath: ${server.servletPath}/health
</code></pre>
<p>è¿™äº›é“¾æ¥æ˜¾ç¤ºåœ¨å®¢æˆ·ç«¯ä½¿ç”¨çš„å…ƒæ•°æ®ä¸­ï¼Œå¹¶ä¸”åœ¨æŸäº›åœºæ™¯ä¸­ç”¨äºå†³å®šæ˜¯å¦å‘åº”ç”¨ç¨‹åºå‘é€è¯·æ±‚ï¼Œå› æ­¤å¦‚æœè¿™äº›è¯·æ±‚æ˜¯å‡†ç¡®çš„ï¼Œå°±å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<blockquote>
<p>åœ¨Dalston(ç‰ˆæœ¬åå­—)ä¸­ï¼Œå½“æ›´æ”¹ç®¡ç†ä¸Šä¸‹æ–‡è·¯å¾„æ—¶ï¼Œè¿˜éœ€è¦è®¾ç½®çŠ¶æ€å’Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥urlã€‚è¿™ä¸ªè¦æ±‚ä»Edgwareå¼€å§‹å°±è¢«åˆ é™¤äº†</p>
</blockquote>
<h3 id="15-æ³¨å†Œå®‰å…¨çš„åº”ç”¨ç¨‹åº"><a class="header" href="#15-æ³¨å†Œå®‰å…¨çš„åº”ç”¨ç¨‹åº">1.5 æ³¨å†Œå®‰å…¨çš„åº”ç”¨ç¨‹åº</a></h3>
<p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºå¸Œæœ›é€šè¿‡ HTTPS è¿›è¡Œè”ç³»ï¼Œå¯ä»¥åœ¨EurekaInstanceConfigBean ä¸­è®¾ç½®ä¸¤ä¸ªå±æ€§:</p>
<ul>
<li><code>Eureka.instance.[nonsecurtenabled]=[false]</code></li>
<li><code>Eureka.instance.[securePortEnabled]=[true]</code></li>
</ul>
<p>è¿™æ ·åšä½¿Eurekaå‘å¸ƒçš„å®ä¾‹ä¿¡æ¯æ˜¾ç¤ºäº†å¯¹å®‰å…¨é€šä¿¡çš„æ˜ç¡®åå¥½ã€‚Spring Cloud <code>DiscoveryClient</code> æ€»æ˜¯è¿”å›ä¸€ä¸ªä»¥ httpså¼€å¤´çš„ URIï¼Œç”¨äºä»¥è¿™ç§æ–¹å¼é…ç½®çš„æœåŠ¡ã€‚ç±»ä¼¼åœ°ï¼Œå½“ä»¥è¿™ç§æ–¹å¼é…ç½®æœåŠ¡æ—¶ï¼ŒEureka (æœ¬æœº)å®ä¾‹ä¿¡æ¯å…·æœ‰ä¸€ä¸ªå®‰å…¨çš„å¥åº·æ£€æŸ¥ URLã€‚</p>
<p>ç”±äºEurekaå†…éƒ¨çš„å·¥ä½œæ–¹å¼ï¼Œå®ƒä»ç„¶ä¸ºçŠ¶æ€å’Œä¸»é¡µå‘å¸ƒä¸€ä¸ªä¸å®‰å…¨çš„URLï¼Œé™¤éä½ ä¹Ÿæ˜¾å¼åœ°è¦†ç›–è¿™äº›å†…å®¹ã€‚ä½ å¯ä»¥ä½¿ç”¨å ä½ç¬¦æ¥é…ç½®eurekaå®ä¾‹ urlï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p>
<p><strong>application.yml</strong></p>
<pre><code class="language-yml">eureka:
  instance:
    statusPageUrl: https://${eureka.hostname}/info
    healthCheckUrl: https://${eureka.hostname}/health
    homePageUrl: https://${eureka.hostname}/
</code></pre>
<p>(æ³¨æ„ <code>${Eureka.hostname}</code>æ˜¯ä¸€ä¸ªæœ¬æœºå ä½ç¬¦ï¼Œåªèƒ½åœ¨ Eureka çš„åç»­ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚å¯¹äºSpringå ä½ç¬¦ä¹Ÿå¯ä»¥å®ç°åŒæ ·çš„åŠŸèƒ½ãƒ¼ãƒ¼ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>${eureka.instance.hostname}</code>.)</p>
<blockquote>
<p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ä»£ç†ä¹‹åï¼Œå¹¶ä¸”SSLç»ˆæ­¢åœ¨ä»£ç†ä¸­(ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½œä¸ºæœåŠ¡è¿è¡Œåœ¨Cloud Foundryæˆ–å…¶ä»–å¹³å°ä¸Š) ï¼Œç„¶åï¼Œä½ éœ€è¦ç¡®ä¿â€œè½¬å‘â€çš„ä»£ç†å¤´è¢«åº”ç”¨ç¨‹åºæ‹¦æˆªå’Œå¤„ç†ã€‚å¦‚æœåœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­åµŒå…¥çš„Tomcatå®¹å™¨å¯¹'X-Forwarded-* 'å¤´æœ‰æ˜¾å¼é…ç½®ï¼Œè¿™å°†è‡ªåŠ¨ç”Ÿæ•ˆã€‚åº”ç”¨ç¨‹åºå‘ˆç°ç»™è‡ªèº«çš„é“¾æ¥æ˜¯é”™è¯¯çš„(é”™è¯¯çš„ä¸»æœºã€ç«¯å£æˆ–åè®®)ï¼Œè¿™æ˜¯é…ç½®é”™è¯¯çš„æ ‡å¿—ã€‚</p>
</blockquote>
<h3 id="16-eurekaçš„å¥åº·æ£€æŸ¥"><a class="header" href="#16-eurekaçš„å¥åº·æ£€æŸ¥">1.6 Eurekaçš„å¥åº·æ£€æŸ¥</a></h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒEurekaä½¿ç”¨å®¢æˆ·ç«¯å¿ƒè·³æ¥ç¡®å®šå®¢æˆ·ç«¯æ˜¯å¦å¯åŠ¨ã€‚é™¤éå¦è¡ŒæŒ‡å®šï¼Œå¦åˆ™å‘ç°å®¢æˆ·ç«¯ä¸ä¼šæ ¹æ®Spring Bootæ‰§è¡Œå™¨ä¼ æ’­åº”ç”¨ç¨‹åºçš„å½“å‰è¿è¡ŒçŠ¶å†µæ£€æŸ¥çŠ¶æ€ã€‚å› æ­¤ï¼Œåœ¨æˆåŠŸæ³¨å†Œåï¼ŒEurekaæ€»æ˜¯å®£å¸ƒåº”ç”¨ç¨‹åºå¤„äº<code>UP</code>çŠ¶æ€ã€‚å¯ä»¥é€šè¿‡å¯ç”¨Eurekaè¿è¡ŒçŠ¶å†µæ£€æŸ¥æ¥æ›´æ”¹æ­¤è¡Œä¸ºï¼Œè¿™å°†å¯¼è‡´å°†åº”ç”¨ç¨‹åºçŠ¶æ€ä¼ æ’­åˆ°Eurekaã€‚å› æ­¤ï¼Œæ¯ä¸ªå…¶ä»–åº”ç”¨ç¨‹åºä¸ä¼šå‘å¤„äº<code>UP</code>çŠ¶æ€ä»¥å¤–çš„åº”ç”¨ç¨‹åºå‘é€æµé‡ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä¸ºå®¢æˆ·ç«¯å¯ç”¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚</p>
<p><strong>application.yml</strong></p>
<pre><code class="language-yml">eureka:
  client:
    healthcheck:
      enabled: true
</code></pre>
<blockquote>
<p><code>eureka.client.healthcheck.enabled=true</code>åº”è¯¥åªåœ¨<code>application.yml</code>ä¸­è®¾ç½®ã€‚åœ¨<code>bootstrap.yml</code>ä¸­è®¾ç½®è¿™ä¸ªå€¼ä¼šå¼•èµ·ä¸å¥½çš„å‰¯ä½œç”¨ã€‚ä¾‹å¦‚åœ¨Eurekaä»¥<code>UNKNOWN</code>çŠ¶æ€æ³¨å†Œã€‚</p>
</blockquote>
<p>å¦‚æœä½ éœ€è¦å¯¹è¿è¡ŒçŠ¶å†µæ£€æŸ¥è¿›è¡Œæ›´å¤šçš„æ§åˆ¶ï¼Œå¯ä»¥è€ƒè™‘å®ç°è‡ªå·±çš„æ£€æŸ¥<code>com.netflix.appinfo.HealthCheckHandler</code>ã€‚</p>
<h3 id="17-eureka-clientå’Œå®ä¾‹çš„å…ƒæ•°æ®"><a class="header" href="#17-eureka-clientå’Œå®ä¾‹çš„å…ƒæ•°æ®">1.7 Eureka clientå’Œå®ä¾‹çš„å…ƒæ•°æ®</a></h3>
<p>èŠ±ç‚¹æ—¶é—´äº†è§£Eurekaå…ƒæ•°æ®æ˜¯å¦‚ä½•å·¥ä½œçš„æ˜¯å€¼å¾—çš„ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥åœ¨æ‚¨çš„å¹³å°ä¸Šä»¥ä¸€ç§æœ‰æ„ä¹‰çš„æ–¹å¼ä½¿ç”¨å®ƒã€‚å¯¹äºä¸»æœºåã€IPåœ°å€ã€ç«¯å£å·ã€çŠ¶æ€é¡µå’Œå¥åº·æ£€æŸ¥ç­‰ä¿¡æ¯ï¼Œæœ‰æ ‡å‡†çš„å…ƒæ•°æ®ã€‚è¿™äº›ä¿¡æ¯å‘å¸ƒåœ¨æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸­ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®ƒä»¬ä»¥ä¸€ç§ç®€å•çš„æ–¹å¼è”ç³»æœåŠ¡ã€‚é™„åŠ çš„å…ƒæ•°æ®å¯ä»¥æ·»åŠ åˆ°å®ä¾‹æ³¨å†Œçš„<code>eureka.instance.metadataMap</code>ä¸­ï¼Œè¯¥å…ƒæ•°æ®å¯ä»¥åœ¨è¿œç¨‹å®¢æˆ·æœºä¸­è®¿é—®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé™„åŠ çš„å…ƒæ•°æ®ä¸ä¼šæ”¹å˜å®¢æˆ·æœºçš„è¡Œä¸ºï¼Œé™¤éå®¢æˆ·æœºçŸ¥é“å…ƒæ•°æ®çš„å«ä¹‰ã€‚åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼ŒSpring Cloudå·²ç»ä¸ºå…ƒæ•°æ®æ˜ å°„èµ‹äºˆäº†æ„ä¹‰ï¼Œæœ¬æ–‡ç¨åå°†å¯¹æ­¤è¿›è¡Œæè¿°ã€‚</p>
<h4 id="171-åœ¨cloud-foundryä¸Šä½¿ç”¨eureka"><a class="header" href="#171-åœ¨cloud-foundryä¸Šä½¿ç”¨eureka">1.7.1 åœ¨Cloud Foundryä¸Šä½¿ç”¨Eureka</a></h4>
<p>Cloud Foundryæœ‰ä¸€ä¸ªå…¨å±€è·¯ç”±å™¨ï¼Œè¿™æ ·åŒä¸€ä¸ªåº”ç”¨çš„æ‰€æœ‰å®ä¾‹éƒ½æœ‰ç›¸åŒçš„ä¸»æœºå(å…¶ä»–å…·æœ‰ç±»ä¼¼æ¶æ„çš„PaaSè§£å†³æ–¹æ¡ˆä¹Ÿæœ‰ç›¸åŒçš„å®‰æ’)ã€‚è¿™å¹¶ä¸ä¸€å®šæ˜¯ä½¿ç”¨Eurekaçš„éšœç¢ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨è·¯ç”±å™¨(å»ºè®®æˆ–å¼ºåˆ¶ä½¿ç”¨ï¼Œè¿™å–å†³äºå¹³å°çš„è®¾ç½®æ–¹å¼)ï¼Œåˆ™éœ€è¦æ˜¾å¼è®¾ç½®ä¸»æœºåå’Œç«¯å£å·(å®‰å…¨æˆ–ä¸å®‰å…¨)ï¼Œä»¥ä¾¿å®ƒä»¬ä½¿ç”¨è·¯ç”±å™¨ã€‚ä½ å¯èƒ½è¿˜å¸Œæœ›ä½¿ç”¨å®ä¾‹å…ƒæ•°æ®ï¼Œä»¥ä¾¿èƒ½å¤ŸåŒºåˆ†å®¢æˆ·æœºä¸Šçš„å®ä¾‹(ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰è´Ÿè½½å¹³è¡¡å™¨ä¸­)ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>eureka.instance.instanceId</code>æ˜¯<code>vcap.application.Instance_id</code>ï¼Œç¤ºä¾‹å¦‚ä¸‹:</p>
<p><strong>application.yml</strong></p>
<pre><code class="language-yml">eureka:
  instance:
    hostname: ${vcap.application.uris[0]}
    nonSecurePort: 80
</code></pre>
<p>æ ¹æ®åœ¨Cloud Foundryå®ä¾‹ä¸­è®¾ç½®å®‰å…¨è§„åˆ™çš„æ–¹å¼ï¼Œæ‚¨èƒ½å¤Ÿæ³¨å†Œå¹¶ä½¿ç”¨ä¸»æœºVMçš„IPåœ°å€æ¥è¿›è¡Œç›´æ¥çš„æœåŠ¡åˆ°æœåŠ¡è°ƒç”¨ã€‚è¿™ä¸ªç‰¹æ€§åœ¨å…³é”®çš„WebæœåŠ¡(PWS)ä¸Šè¿˜ä¸å¯ç”¨ã€‚</p>
<h4 id="172-åœ¨awsä¸Šä½¿ç”¨eureka"><a class="header" href="#172-åœ¨awsä¸Šä½¿ç”¨eureka">1.7.2 åœ¨AWSä¸Šä½¿ç”¨Eureka</a></h4>
<p>å¦‚æœè®¡åˆ’å°†åº”ç”¨éƒ¨ç½²åˆ°AWSäº‘ï¼Œåˆ™å¿…é¡»å°†Eurekaå®ä¾‹é…ç½®ä¸ºAWSæ„ŸçŸ¥ã€‚ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®šåˆ¶<code>EurekaInstanceConfigBean</code>:</p>
<pre><code class="language-java">@Bean
@Profile(&quot;!default&quot;)
public EurekaInstanceConfigBean eurekaInstanceConfig(InetUtils inetUtils) {
  EurekaInstanceConfigBean bean = new EurekaInstanceConfigBean(inetUtils);
  AmazonInfo info = AmazonInfo.Builder.newBuilder().autoBuild(&quot;eureka&quot;);
  bean.setDataCenterInfo(info);
  return bean;
}
</code></pre>
<h4 id="173-ä¿®æ”¹eurekaçš„å®ä¾‹id"><a class="header" href="#173-ä¿®æ”¹eurekaçš„å®ä¾‹id">1.7.3 ä¿®æ”¹Eurekaçš„å®ä¾‹ID</a></h4>
<p>ä¸€ä¸ªæ™®é€šçš„Netflix Eurekaå®ä¾‹æ˜¯ç”¨ä¸€ä¸ªä¸å®ƒçš„ä¸»æœºåç›¸ç­‰çš„IDæ³¨å†Œçš„(ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªä¸»æœºåªæœ‰ä¸€ä¸ªæœåŠ¡)ã€‚Spring Cloud Eurekaæä¾›äº†ä¸€ä¸ªåˆç†çš„é»˜è®¤å€¼ï¼Œå®šä¹‰å¦‚ä¸‹:
<code>${spring.cloud.client.hostname}:${spring.application.name}:${spring.application.instance_id:${server.port}}</code></p>
<p>ä¸€ä¸ªä¾‹å­æ˜¯ï¼š<code>myhost:myappname:8080</code>ã€‚
é€šè¿‡ä½¿ç”¨Spring Cloudï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨<code>eureka.instance.instanceId</code>ä¸­æä¾›å”¯ä¸€çš„æ ‡è¯†ç¬¦æ¥è¦†ç›–è¿™ä¸ªå€¼ã€‚ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p>
<p><strong>application.yml</strong></p>
<pre><code class="language-yml">eureka:
  instance:
    instanceId: ${spring.application.name}:${vcap.application.instance_id:${spring.application.instance_id:${random.value}}}
</code></pre>
<p>ä½¿ç”¨å‰é¢ç¤ºä¾‹ä¸­æ˜¾ç¤ºçš„å…ƒæ•°æ®å’Œéƒ¨ç½²åœ¨localhostä¸Šçš„å¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œå°†æ’å…¥éšæœºå€¼ä»¥ä½¿å®ä¾‹å”¯ä¸€ã€‚åœ¨Cloud Foundryä¸­ï¼Œ<code>vcap.application.instance_id</code>æ˜¯åœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­è‡ªåŠ¨å¡«å……çš„ï¼Œå› æ­¤ä¸éœ€è¦è¿™ä¸ªéšæœºå€¼ã€‚</p>
<h3 id="18-ä½¿ç”¨eurekaclient"><a class="header" href="#18-ä½¿ç”¨eurekaclient">1.8 ä½¿ç”¨EurekaClient</a></h3>
<p>ä¸€æ—¦ä½ æ‹¥æœ‰äº†ä¸€ä¸ªä½œä¸ºå‘ç°å®¢æˆ·ç«¯çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨å®ƒä»<code>Eureka Server</code>å‘ç°æœåŠ¡å®ä¾‹ã€‚ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æœ¬æœº<code>com.netflix.discovery.EurekaClient</code>(ä¸Spring Cloud DiscoveryClientç›¸å)ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚</p>
<pre><code class="language-java">@Autowired
private EurekaClient discoveryClient;

public String serviceUrl() {
    InstanceInfo instance = discoveryClient.getNextServerFromEureka(&quot;STORES&quot;, false);
    return instance.getHomePageUrl();
}
</code></pre>
<blockquote>
<p>ä¸è¦åœ¨<code>@PostConstruct</code>æ–¹æ³•æˆ–<code>@Scheduled</code>æ–¹æ³•ä¸­ä½¿ç”¨<code>eurekclient</code>(æˆ–åœ¨<code>ApplicationContext</code>å¯èƒ½è¿˜æ²¡æœ‰å¯åŠ¨çš„ä»»ä½•åœ°æ–¹)ã€‚å®ƒæ˜¯åœ¨<code>SmartLifecycle</code>ä¸­åˆå§‹åŒ–çš„(<code>phase=0</code>)ï¼Œæ‰€ä»¥ä½ æœ€æ—©å¯ä»¥ä¾èµ–å®ƒæ˜¯åœ¨å¦ä¸€ä¸ªå…·æœ‰æ›´é«˜é˜¶æ®µçš„<code>SmartLifecycle</code>ä¸­ã€‚</p>
</blockquote>
<h4 id="181-eurekaclietæ²¡æœ‰jersey"><a class="header" href="#181-eurekaclietæ²¡æœ‰jersey">1.8.1 EurekaClietæ²¡æœ‰Jersey</a></h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œeurekclientä½¿ç”¨Springçš„<code>RestTemplate</code>è¿›è¡ŒHTTPé€šä¿¡ã€‚å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨Jerseyï¼Œåˆ™éœ€è¦å°†Jerseyä¾èµ–é¡¹æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä½ éœ€è¦æ·»åŠ çš„åŒ…ç®¡ç†æ–‡ä»¶ä¸­:</p>
<pre><code class="language-pom">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-core&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-apache-client4&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="19-æ›¿ä»£åŸç”Ÿnetflix-eurakaclient"><a class="header" href="#19-æ›¿ä»£åŸç”Ÿnetflix-eurakaclient">1.9 æ›¿ä»£åŸç”ŸNetflix EurakaClient</a></h3>
<p>ä½ ä¸éœ€è¦ä½¿ç”¨åŸå§‹çš„<code>Netflix eurekclient</code>ã€‚åœ¨æŸç§å°è£…åé¢ä½¿ç”¨å®ƒé€šå¸¸æ›´æ–¹ä¾¿ã€‚Spring Cloudé€šè¿‡é€»è¾‘çš„EurekaæœåŠ¡æ ‡è¯†ç¬¦(VIPs)è€Œä¸æ˜¯ç‰©ç†urlæ”¯æŒ<code>Feign</code>(ä¸€ä¸ªRESTå®¢æˆ·ç«¯æ„å»ºå™¨)å’Œ<code>Spring RestTemplate</code>çš„è¿œç¨‹è°ƒç”¨ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨<code>org.springframework.cloud.client.discovery.DiscoveryClient</code>å®ƒä¸ºå‘ç°å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªç®€å•çš„API(ä¸ç‰¹å®šäºNetflix)ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤º:</p>
<pre><code class="language-java">@Autowired
private DiscoveryClient discoveryClient;

public String serviceUrl() {
    List&lt;ServiceInstance&gt; list = discoveryClient.getInstances(&quot;STORES&quot;);
    if (list != null &amp;&amp; list.size() &gt; 0 ) {
        return list.get(0).getUri();
    }
    return null;
}
</code></pre>
<h3 id="110-ä¸ºä»€ä¹ˆæ³¨å†ŒæœåŠ¡å¦‚æ­¤ç¼“æ…¢"><a class="header" href="#110-ä¸ºä»€ä¹ˆæ³¨å†ŒæœåŠ¡å¦‚æ­¤ç¼“æ…¢">1.10 ä¸ºä»€ä¹ˆæ³¨å†ŒæœåŠ¡å¦‚æ­¤ç¼“æ…¢</a></h3>
<p>ä½œä¸ºä¸€ä¸ªå®ä¾‹è¿˜æ¶‰åŠåˆ°åˆ°æ³¨å†Œä¸­å¿ƒçš„å‘¨æœŸæ€§å¿ƒè·³(é€šè¿‡å®¢æˆ·æœºçš„serviceUrl)ï¼Œé»˜è®¤æŒç»­æ—¶é—´ä¸º30ç§’ã€‚åœ¨å®ä¾‹ã€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æœ¬åœ°ç¼“å­˜ä¸­éƒ½æœ‰ç›¸åŒçš„å…ƒæ•°æ®ä¹‹å‰ï¼Œå®¢æˆ·ç«¯æ— æ³•å‘ç°æœåŠ¡(å› æ­¤å¯èƒ½éœ€è¦3æ¬¡å¿ƒè·³)ã€‚å¯ä»¥é€šè¿‡è®¾ç½®<code>eureka.instance.leaseRenewalIntervalInSeconds</code>æ¥ä¿®æ”¹å‘¨æœŸã€‚å°†å…¶è®¾ç½®ä¸ºå°äº30çš„å€¼å°†åŠ å¿«ä½¿å®¢æˆ·ç«¯è¿æ¥åˆ°å…¶ä»–æœåŠ¡çš„è¿‡ç¨‹ã€‚åœ¨ç”Ÿäº§ä¸­ï¼Œä½¿ç”¨é»˜è®¤å€¼å¯èƒ½æ›´å¥½ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸­çš„å†…éƒ¨è®¡ç®—ä¼šå¯¹ç§ŸæœŸç»­æœŸåšå‡ºå‡è®¾ã€‚</p>
<h3 id="111-zones"><a class="header" href="#111-zones">1.11 Zones</a></h3>
<p>å¦‚æœæ‚¨å·²ç»å°†Eurekaå®¢æˆ·ç«¯éƒ¨ç½²åˆ°å¤šä¸ªåŒºåŸŸï¼Œæ‚¨å¯èƒ½å¸Œæœ›è¿™äº›å®¢æˆ·ç«¯åœ¨å°è¯•å…¶ä»–åŒºåŸŸä¸­çš„æœåŠ¡ä¹‹å‰å…ˆä½¿ç”¨ç›¸åŒåŒºåŸŸä¸­çš„æœåŠ¡ã€‚è¦è¿›è¡Œè®¾ç½®ï¼Œéœ€è¦æ­£ç¡®é…ç½®Eurekaå®¢æˆ·ç«¯ã€‚
é¦–å…ˆï¼Œæ‚¨éœ€è¦ç¡®ä¿å°†EurekaæœåŠ¡å™¨éƒ¨ç½²åˆ°æ¯ä¸ªåŒºåŸŸï¼Œå¹¶ä¸”å®ƒä»¬å½¼æ­¤æ˜¯å¯¹ç­‰çš„ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…åŒºåŸŸå’Œåœ°åŒºä¸€èŠ‚ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦å‘Šè¯‰Eurekaä½ çš„æœåŠ¡åœ¨å“ªä¸ªåŒºåŸŸã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨<code>metadatmap</code>å±æ€§æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œservice 1åŒæ—¶éƒ¨ç½²åœ¨zone 1å’Œzone 2ï¼Œåˆ™éœ€è¦åœ¨service 1ä¸­è®¾ç½®å¦‚ä¸‹Eurekaå±æ€§:</p>
<p><strong>Service 1 in Zone 1</strong></p>
<pre><code class="language-yml">eureka.instance.metadataMap.zone = zone1
eureka.client.preferSameZoneEureka = true
</code></pre>
<p><strong>Service 1 in Zone 2</strong></p>
<pre><code class="language-yml">eureka.instance.metadataMap.zone = zone2
eureka.client.preferSameZoneEureka = true
</code></pre>
<h3 id="112-åˆ·æ–°eureka-client"><a class="header" href="#112-åˆ·æ–°eureka-client">1.12 åˆ·æ–°Eureka client</a></h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>EurekaClient bean</code>æ˜¯å¯åˆ·æ–°çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥æ›´æ”¹å’Œåˆ·æ–°Eurekaå®¢æˆ·æœºå±æ€§ã€‚å½“åˆ·æ–°å‘ç”Ÿæ—¶ï¼Œå®¢æˆ·ç«¯å°†ä»EurekaæœåŠ¡å™¨æ³¨é”€ï¼Œå¹¶ä¸”å¯èƒ½æœ‰ä¸€æ®µçŸ­æš‚çš„æ—¶é—´å†…ç»™å®šæœåŠ¡çš„æ‰€æœ‰å®ä¾‹éƒ½ä¸å¯ç”¨ã€‚æ¶ˆé™¤è¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹æ³•æ˜¯ç¦ç”¨åˆ·æ–°Eurekaå®¢æˆ·æœºçš„åŠŸèƒ½ã€‚è®¾ç½®<code>eureka.client.refresh.enable=false</code>ã€‚</p>
<h3 id="113-ä½¿ç”¨springcloudè´Ÿè½½å‡è¡¡çš„eureka"><a class="header" href="#113-ä½¿ç”¨springcloudè´Ÿè½½å‡è¡¡çš„eureka">1.13 ä½¿ç”¨SpringCloudè´Ÿè½½å‡è¡¡çš„Eureka</a></h3>
<p>æˆ‘ä»¬æä¾›å¯¹<code>Spring CLoud LoadBalancer ZonePreferenceServiceInstanceListSupplier</code>çš„æ”¯æŒã€‚Eurekaå®ä¾‹å…ƒæ•°æ®(Eureka.instance. metadatmap zone)ä¸­çš„zoneå€¼ç”¨äºè®¾ç½®spring-cloud-loadbalancer-zoneå±æ€§çš„å€¼ï¼Œè¯¥å±æ€§ç”¨äºæŒ‰zoneè¿‡æ»¤æœåŠ¡å®ä¾‹ã€‚</p>
<p>å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå¹¶ä¸”<code>spring.cloud.loadbalancer.eureka.approximateZoneFromHostname</code>æ ‡å¿—è¢«è®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ä½¿ç”¨æœåŠ¡å™¨ä¸»æœºåä¸­çš„åŸŸåä½œä¸ºåŒºåŸŸçš„ä»£ç†ã€‚</p>
<p>å¦‚æœæ²¡æœ‰å…¶ä»–åŒºåŸŸæ•°æ®æ¥æºï¼Œåˆ™åŸºäºå®¢æˆ·ç«¯é…ç½®ï¼ˆè€Œä¸æ˜¯å®ä¾‹é…ç½®ï¼‰è¿›è¡ŒçŒœæµ‹ã€‚ æˆ‘ä»¬é‡‡å–<code>eureka.client.availabilityZones</code>ï¼Œå®ƒæ˜¯ä»åŒºåŸŸåç§°åˆ°åŒºåŸŸåˆ—è¡¨çš„åœ°å›¾ï¼Œå¹¶é‡Šæ”¾äº†å®ä¾‹è‡ªå·±çš„åŒºåŸŸçš„ç¬¬ä¸€ä¸ªåŒºåŸŸï¼ˆå³<code>eureka.client.region</code>ï¼Œé»˜è®¤ä¸º<code>us-east-1</code>ï¼Œç”¨äºä¸æœ¬æœºNetflixçš„å…¼å®¹æ€§ï¼‰ã€‚</p>
<h2 id="2-æœåŠ¡å‘ç°eureka-server"><a class="header" href="#2-æœåŠ¡å‘ç°eureka-server">2. æœåŠ¡å‘ç°ï¼šEureka Server</a></h2>
<p>ä»‹ç»æ­å»ºEurekaæœåŠ¡å™¨çš„æ“ä½œæ­¥éª¤ã€‚</p>
<h3 id="21-å¦‚ä½•åŒ…å«eureka-server"><a class="header" href="#21-å¦‚ä½•åŒ…å«eureka-server">2.1 å¦‚ä½•åŒ…å«Eureka Server</a></h3>
<p>è¦å°†<code>Eureka Server</code>åŒ…å«åˆ°æ‚¨çš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨gourp IDä¸º<code>org.springframework.cloud</code>å’Œ artifact IDä¸º<code>spring-cloud-start-netflix- Eureka-Server</code>çš„å¯åŠ¨å™¨ã€‚æœ‰å…³ä½¿ç”¨å½“å‰<code>Spring Cloud Release Train</code>è®¾ç½®æ„å»ºç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Spring Cloud Projecté¡µé¢ã€‚</p>
<blockquote>
<p>å¦‚æœæ‚¨çš„é¡¹ç›®å·²ç»ä½¿ç”¨<code>Thymeleaf</code>ä½œä¸ºæ¨¡æ¿å¼•æ“ï¼ŒEurekaæœåŠ¡å™¨çš„<code>Freemarker</code>æ¨¡æ¿å¯èƒ½æ— æ³•æ­£ç¡®åŠ è½½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦æ‰‹åŠ¨é…ç½®æ¨¡æ¿åŠ è½½å™¨:</p>
</blockquote>
<p><strong>application.yml</strong></p>
<pre><code class="language-yml">spring:
  freemarker:
    template-loader-path: classpath:/templates/
    prefer-file-system-access: false
</code></pre>
<h3 id="22-å¦‚ä½•è¿è¡Œeureka-server"><a class="header" href="#22-å¦‚ä½•è¿è¡Œeureka-server">2.2 å¦‚ä½•è¿è¡ŒEureka Server</a></h3>
<p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªæœ€å°çš„EurekaæœåŠ¡å™¨:</p>
<pre><code class="language-java">@SpringBootApplication
@EnableEurekaServer
public class Application {

    public static void main(String[] args) {
        new SpringApplicationBuilder(Application.class).web(true).run(args);
    }

}
</code></pre>
<p>æœåŠ¡å™¨å…·æœ‰ä¸»é¡µï¼Œå…¶ä¸­åŒ…å«UIç•Œé¢å’ŒHTTP APIç«¯ç‚¹ï¼Œä½œç”¨ä¸/eureka/*ã€‚</p>
<p>ä»¥ä¸‹é“¾æ¥æœ‰ä¸€äº›EurekaèƒŒæ™¯çŸ¥è¯†ï¼Œ<a href="https://github.com/cfregly/fluxcapacitor/wiki/NetflixOSS-FAQ#eureka-service-discovery-load-balancer">flux capacitor</a> and <a href="https://groups.google.com/forum/?fromgroups#!topic/eureka_netflix/g3p2r7gHnN0">google group discussion</a>.</p>
<p>ç”±äºGradleçš„ä¾èµ–è§£æè§„åˆ™å’Œç¼ºå°‘çˆ¶bomç‰¹æ€§ï¼Œä¾èµ–<code>spring-cloud-start-netflix-eureka-server</code>å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨å¯åŠ¨å¤±è´¥ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ·»åŠ <code>Spring Boot Gradle</code>æ’ä»¶ï¼Œå¹¶å¯¼å…¥Springäº‘å¯åŠ¨å™¨çš„çˆ¶bomå¦‚ä¸‹:</p>
<p><strong>build.gradle</strong></p>
<pre><code class="language-gradle">buildscript {
  dependencies {
    classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:{spring-boot-docs-version}&quot;)
  }
}

apply plugin: &quot;spring-boot&quot;

dependencyManagement {
  imports {
    mavenBom &quot;org.springframework.cloud:spring-cloud-dependencies:{spring-cloud-version}&quot;
  }
}
</code></pre>
<h3 id="23-é«˜å¯ç”¨zones-å’Œ-regions"><a class="header" href="#23-é«˜å¯ç”¨zones-å’Œ-regions">2.3 é«˜å¯ç”¨ï¼ŒZones å’Œ Regions</a></h3>
<p>EurekaæœåŠ¡å™¨æ²¡æœ‰åç«¯å­˜å‚¨ï¼Œä½†æ˜¯æ³¨å†Œä¸­å¿ƒä¸­çš„æœåŠ¡å®ä¾‹éƒ½å¿…é¡»å‘é€å¿ƒè·³ä»¥ä¿æŒå…¶çŠ¶æ€çš„æ›´æ–°(æ‰€ä»¥è¿™å¯ä»¥åœ¨å†…å­˜ä¸­å®Œæˆ)ã€‚å®¢æˆ·ç«¯ä¹Ÿæœ‰ä¸€ä¸ªEurekaæ³¨å†Œçš„å†…å­˜ç¼“å­˜(æ‰€ä»¥ä»–ä»¬ä¸å¿…ä¸ºæ¯ä¸ªæœåŠ¡è¯·æ±‚éƒ½å»æ³¨å†Œä¸­å¿ƒ)ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªEurekaæœåŠ¡å™¨ä¹Ÿæ˜¯ä¸€ä¸ªEurekaå®¢æˆ·ç«¯ï¼Œå¹¶ä¸”éœ€è¦(è‡³å°‘ä¸€ä¸ª)æœåŠ¡URLæ¥å®šä½å¯¹ç­‰ç‚¹ã€‚å¦‚æœä½ ä¸æä¾›å®ƒï¼ŒæœåŠ¡ä¹Ÿä¼šè¿è¡Œå¹¶å·¥ä½œï¼Œä½†å®ƒä¼šç”¨è®¸å¤šå…³äºæ— æ³•æ³¨å†Œè¿›å¯¹ç­‰æ³¨å†Œä¸­å¿ƒçš„ä¿¡æ¯è®°å½•å¡«å……ä½ çš„æ—¥å¿—ã€‚</p>
<h3 id="24-ç‹¬ç«‹æ¨¡å¼"><a class="header" href="#24-ç‹¬ç«‹æ¨¡å¼">2.4 ç‹¬ç«‹æ¨¡å¼</a></h3>
<p>ä¸¤ä¸ªç¼“å­˜(å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨)å’Œå¿ƒè·³çš„ç»“åˆä½¿ç‹¬ç«‹çš„EurekaæœåŠ¡å™¨åœ¨æ•…éšœæ—¶ç›¸å½“æœ‰å¼¹æ€§ï¼Œåªè¦æœ‰æŸç§ç›‘æ§æˆ–å¼¹æ€§è¿è¡Œæ—¶(å¦‚Cloud Foundry)ä¿æŒå®ƒçš„æ´»åŠ›ã€‚åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹ï¼Œä½ å¯èƒ½æ›´å¸Œæœ›å…³é—­å®¢æˆ·ç«¯è¡Œä¸ºï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šä¸€ç›´å°è¯•è®¿é—®å…¶ä»–èŠ‚ç‚¹è€Œå¤±è´¥ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å…³é—­å®¢æˆ·ç«¯è¡Œä¸º:</p>
<p><strong>application.yml (ç‹¬ç«‹çš„EurekaæœåŠ¡å™¨)</strong></p>
<pre><code class="language-yml">server:
  port: 8761

eureka:
  instance:
    hostname: localhost
  client:
    registerWithEureka: false
    fetchRegistry: false
    serviceUrl:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/
</code></pre>
<p>æ³¨æ„<code>serviceUrl</code>æŒ‡å‘ä¸æœ¬åœ°å®ä¾‹ç›¸åŒçš„ä¸»æœºã€‚</p>
<h3 id="25-å¯¹ç­‰æ¨¡å¼"><a class="header" href="#25-å¯¹ç­‰æ¨¡å¼">2.5 å¯¹ç­‰æ¨¡å¼</a></h3>
<p>é€šè¿‡è¿è¡Œå¤šä¸ªå®ä¾‹å¹¶è¦æ±‚å®ƒä»¬ç›¸äº’æ³¨å†Œï¼ŒEurekaå¯ä»¥å˜å¾—æ›´åŠ çµæ´»å’Œå¯ç”¨ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯é»˜è®¤çš„è¡Œä¸ºï¼Œæ‰€ä»¥ä½ åªéœ€è¦å‘å¯¹ç­‰ä½“æ·»åŠ ä¸€ä¸ªæœ‰æ•ˆçš„serviceUrlï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p>
<p><strong>application.yml (ä¸¤ä¸ªå¯¹ç­‰çš„EurekaæœåŠ¡å™¨)</strong></p>
<pre><code class="language-yml">---
spring:
  profiles: peer1
eureka:
  instance:
    hostname: peer1
  client:
    serviceUrl:
      defaultZone: https://peer2/eureka/

---
spring:
  profiles: peer2
eureka:
  instance:
    hostname: peer2
  client:
    serviceUrl:
      defaultZone: https://peer1/eureka/
</code></pre>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªYAMLæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡åœ¨ä¸åŒçš„Springæ–‡ä»¶ä¸­é…ç½®è¿è¡Œå®ƒæ¥åœ¨ä¸¤å°ä¸»æœº(peer1å’Œpeer2)ä¸Šè¿è¡Œç›¸åŒçš„æœåŠ¡å™¨ã€‚é€šè¿‡æ“ä½œ<code>/etc/hosts</code>è§£æä¸»æœºåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤é…ç½®åœ¨å•ä¸ªä¸»æœºä¸Šæµ‹è¯•å¯¹ç­‰æ„ŸçŸ¥(åœ¨ç”Ÿäº§ä¸­è¿™æ ·åšæ²¡æœ‰å¤šå¤§ä»·å€¼)ã€‚äº‹å®ä¸Šï¼Œå¦‚æœè¿è¡Œåœ¨çŸ¥é“è‡ªå·±ä¸»æœºåçš„æœºå™¨ä¸Š(é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>java.net.InetAddress</code>æŸ¥æ‰¾)ï¼Œå°±ä¸éœ€è¦<code>eureka.instance.hostname</code>ã€‚</p>
<p>ä½ å¯ä»¥åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­æ·»åŠ å¤šä¸ªå¯¹ç­‰ä½“ï¼Œåªè¦å®ƒä»¬å½¼æ­¤è‡³å°‘æœ‰ä¸€ä¸ªè¿æ¥ï¼Œå®ƒä»¬å°±ä¼šåŒæ­¥è‡ªå·±çš„æ³¨å†Œã€‚å¦‚æœå¯¹ç­‰ç‚¹åœ¨ç‰©ç†ä¸Šæ˜¯åˆ†ç¦»çš„(åœ¨ä¸€ä¸ªæ•°æ®ä¸­å¿ƒå†…æˆ–å¤šä¸ªæ•°æ®ä¸­å¿ƒä¹‹é—´)ï¼Œé‚£ä¹ˆç³»ç»ŸåŸåˆ™ä¸Šå¯ä»¥æ‰¿å—<code>split-brain</code>ç±»å‹çš„æ•…éšœã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­æ·»åŠ å¤šä¸ªå¯¹ç­‰ä½“ï¼Œåªè¦å®ƒä»¬éƒ½æ˜¯ç›´æ¥è¿æ¥çš„ï¼Œå®ƒä»¬å°±ä¼šåœ¨è‡ªå·±ä¹‹é—´åŒæ­¥æ³¨å†Œã€‚</p>
<p><strong>application.yml (ä¸‰ä¸ªå¯¹ç­‰çš„eurekaæœåŠ¡å™¨)</strong></p>
<pre><code class="language-yml">eureka:
  client:
    serviceUrl:
      defaultZone: https://peer1/eureka/,http://peer2/eureka/,http://peer3/eureka/

---
spring:
  profiles: peer1
eureka:
  instance:
    hostname: peer1

---
spring:
  profiles: peer2
eureka:
  instance:
    hostname: peer2

---
spring:
  profiles: peer3
eureka:
  instance:
    hostname: peer3
</code></pre>
<h3 id="26-ä½•æ—¶é€‰æ‹©ipåœ°å€"><a class="header" href="#26-ä½•æ—¶é€‰æ‹©ipåœ°å€">2.6 ä½•æ—¶é€‰æ‹©IPåœ°å€</a></h3>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒEurekaæœ€å¥½å‘å¸ƒæœåŠ¡çš„IPåœ°å€è€Œä¸æ˜¯ä¸»æœºåã€‚è®¾ç½®<code>eureka.instance.preferipaddress=true</code>ï¼Œå½“åº”ç”¨ç¨‹åºå‘eurekaæ³¨å†Œæ—¶ï¼Œå®ƒä½¿ç”¨å®ƒçš„IPåœ°å€è€Œä¸æ˜¯å®ƒçš„ä¸»æœºåã€‚</p>
<blockquote>
<p>å¦‚æœä¸»æœºåä¸èƒ½ç”±Javaç¡®å®šï¼Œåˆ™å°†IPåœ°å€å‘é€ç»™Eurekaã€‚è®¾ç½®ä¸»æœºåçš„å”¯ä¸€æ–¹æ³•æ˜¯è®¾ç½®eureka.instance.hostnameå±æ€§ã€‚ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡è®¾ç½®ä¸»æœºåâ€”ä¾‹å¦‚ï¼š<code>eureka.instance.hostname=${HOST_NAME}</code>ã€‚</p>
</blockquote>
<h3 id="27-ä¿æŠ¤eureka-server"><a class="header" href="#27-ä¿æŠ¤eureka-server">2.7 ä¿æŠ¤Eureka Server</a></h3>
<p>åªéœ€é€šè¿‡<code>Spring-boot-starter-Security</code>å°†<code>Spring Security</code>æ·»åŠ åˆ°æœåŠ¡å™¨çš„åŒ…ç®¡ç†æ–‡ä»¶ä¸­ï¼Œå°±å¯ä»¥ä¿æŠ¤EurekaæœåŠ¡å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Spring Securityåœ¨åŒ…ç®¡ç†æ–‡ä»¶ä¸­ï¼Œå®ƒå°†è¦æ±‚ä¸€ä¸ªæœ‰æ•ˆçš„CSRFä»¤ç‰Œè¢«å‘é€åˆ°åº”ç”¨ç¨‹åºã€‚Eurekaå®¢æˆ·ç«¯é€šå¸¸ä¸ä¼šæ‹¥æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„è·¨ç«™è¯·æ±‚ä¼ªé€ (CSRF)ä»¤ç‰Œï¼Œä½ éœ€è¦ä¸º<code>/Eureka/**</code>ç«¯ç‚¹ç¦ç”¨è¿™ä¸ªè¦æ±‚ã€‚ä¾‹å¦‚:</p>
<pre><code class="language-java">@EnableWebSecurity
class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.csrf().ignoringAntMatchers(&quot;/eureka/**&quot;);
        super.configure(http);
    }
}
</code></pre>
<p>æœ‰å…³CSRFçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#csrf">Spring Security</a>æ–‡æ¡£ã€‚
åœ¨Spring Cloud Samples <a href="https://github.com/spring-cloud-samples/eureka/tree/Eureka-With-Security">repo</a>ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ¼”ç¤ºEureka Serverã€‚</p>
<h3 id="28-jdk11æ”¯æŒ"><a class="header" href="#28-jdk11æ”¯æŒ">2.8 JDK11æ”¯æŒ</a></h3>
<p>JDK 11åˆ é™¤äº†EurekaæœåŠ¡å™¨æ‰€ä¾èµ–çš„JAXBæ¨¡å—ã€‚å¦‚æœä½ æƒ³åœ¨è¿è¡ŒEurekaæœåŠ¡å™¨æ—¶ä½¿ç”¨JDK 11ï¼Œä½ å¿…é¡»åœ¨ä½ çš„POMæˆ–Gradleæ–‡ä»¶ä¸­åŒ…å«è¿™äº›ä¾èµ–é¡¹ã€‚</p>
<pre><code class="language-pom">&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish.jaxb&lt;/groupId&gt;
    &lt;artifactId&gt;jaxb-runtime&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<h2 id="3-é…ç½®å±æ€§"><a class="header" href="#3-é…ç½®å±æ€§">3. é…ç½®å±æ€§</a></h2>
<p>è¦æŸ¥çœ‹æ‰€æœ‰Spring Cloud Netflixç›¸å…³é…ç½®å±æ€§çš„åˆ—è¡¨ï¼Œè¯·æ£€æŸ¥<a href="https://docs.spring.io/spring-cloud-netflix/docs/current/reference/html/appendix.html">é™„å½•é¡µé¢</a>ã€‚</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../spring-cloud/spring-cloud-kubernetes.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../spring-cloud/spring-cloud-open-service-broker.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../spring-cloud/spring-cloud-kubernetes.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../spring-cloud/spring-cloud-open-service-broker.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
                <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
                <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
